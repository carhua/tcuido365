{% extends 'base.html.twig' %}
{% import 'macro/breadcrumb.html.twig' as breadcrumb %}
{% import 'macro/action.html.twig' as action %}

{% set _title = 'Caso Personas Desaparecidas' %}
{% set _main_title = 'Mostrar' %}
{% set _section =  'caso_desaparecido_index'%}

{% block _breadcrumb %}
    {{ breadcrumb.show2(_title,_section,'Mostrar') }}
{% endblock %}

{% block _main %}
    {{ action.tbl_start('table-sm table-bordered') }}
    {{ action.tbl_tr('Distrito',caso_desaparecido.distrito) }}
    {{ action.tbl_tr('Centro Poblado',caso_desaparecido.centroPoblado.nombre) }}
    {{ action.tbl_tr('Fecha de Reporte',caso_desaparecido.fechaReporte) }}
    {{ action.tbl_tr('Descripcion Reporte',caso_desaparecido.descripcionReporte) }}
    <tr>
        <th class="">Denunciante</th>
        {% for tipo in caso_desaparecido.denuncianteDesaparecidos %}
            <td class="text-left">
                <span class="font-weight-bold">Nombres: </span> {{ tipo.nombres|upper }} <br>
                <span class="font-weight-bold">Apellidos :</span> {{ tipo.apellidos|upper  }} <br>
                <span class="font-weight-bold">Tipo Documento: </span>    {{ tipo.tipoDocumento.nombre |upper }} <br>
                <span class="font-weight-bold">Número Documento: </span> {{ tipo.numeroDocumento }}<br>
                <span class="font-weight-bold">Edad: </span>  {{ tipo.edad }}<br>
                <span class="font-weight-bold">Sexo: </span> {{ tipo.sexo.nombre |upper }}<br>
{#                <span class="font-weight-bold">Nacionalidad: </span>  {{ tipo.nacionalidad.nombre|upper  }} <br>#}
                <span class="font-weight-bold">Teléfono: </span> {{ tipo.telefono}}<br>
                <span class="font-weight-bold">Email: </span> {{ tipo.email}}<br>            </td>

        {% endfor %}
    </tr>
    <tr>
        <th class="">Desaparecido(s)</th>
        {% for tipo in caso_desaparecido.desaparecidos %}
            <td class="text-left">
                <span class="font-weight-bold">Nombres: </span> {{ tipo.nombres |upper }} <br>
                <span class="font-weight-bold">Apellidos: </span> {{ tipo.apellidos |upper }} <br>
                <span class="font-weight-bold">Tipo Documento: </span>    {{ tipo.tipoDocumento.nombre |upper }} <br>
                <span class="font-weight-bold">Número Documento: </span> {{ tipo.numeroDocumento }}<br>
                <span class="font-weight-bold">Edad: </span> {{ tipo.edad }}<br>
                <span class="font-weight-bold">Sexo: </span> {{ tipo.sexo.nombre |upper }}<br>
                <span class="font-weight-bold">Nacionalidad: </span>  {{ tipo.nacionalidad.nombre|upper  }} <br>
                <span class="font-weight-bold">Teléfono: </span>  {{ tipo.telefono|upper  }} <br>
                <span class="font-weight-bold">Discapacidad: </span> {{ tipo.discapacidad|upper }}<br>
                <span class="font-weight-bold">Lugar de desaparición: </span> {{ tipo.lugarDesaparicion|upper }}<br>
                <span class="font-weight-bold">Dirección de desaparición: </span> {{ tipo.direccionDesaparicion|upper }}<br>
            </td>
        {% endfor %}
    </tr>

    {{ action.tbl_tr('Estado actual',caso_desaparecido.EstadoCaso) }}
    {{ action.tbl_tr('Institución',caso_desaparecido.Institucion) }}

    {{ action.tbl_end() }}


<h3>Acciones</h3>

    <table id="pc-dt-simple" class="table dataTable-table">
        <thead class="thead-light">
            <tr>
                <th>Nro</th>
                <th>Acciones</th>
                <th>Estado</th>
                <th>Institucion</th>                
                <th>Usuario</th>
                <th>Fecha</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
        {% for acc in accion %}
            <tr>
                <td class="text-left">{{ loop.index }}</td>
                <td class="text-left">{{ acc.descripcion }}</td>
                <td class="text-left">{{ acc.estado.estado }}</td>
                <td class="text-left">{{ acc.institucion ? acc.institucion.name }}</td>
                <td class="text-left">{{ acc.owner.username }}</td>
                <td class="text-left">{{ acc.fecha |date('d-m-Y') }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    {% if caso_desaparecido.EstadoCaso == 'Cerrado' and access.isSuperAdmin() %}
        <div class="card">
            <div class="card-body text-center">
                <form method="post" action="{{ path('caso_desaparecido_reopen', {'id': caso_desaparecido.id}) }}" onsubmit="return confirm('¿Está seguro que desea reaperturar este caso?');">
                    <input type="hidden" name="_token" value="{{ csrf_token('reopen' ~ caso_desaparecido.id) }}">
                    <button class="btn btn-success"><i class="fas fa-folder-open"></i> Aperturar Caso</button>
                </form>
            </div>
        </div>
    {% elseif caso_desaparecido.EstadoCaso not in ['Cerrado', 'Archivado'] %}
        <div class="card-header flex-column flex-lg-row  d-flex align-items-lg-center gap-2 justify-content-between">
            <h6>Nueva acción</h6>
                                        </div>
        <form method="POST" class="needs-validation" novalidate="">
            <div class="card-body">
                <div class="row">
                    <div class="col-sm p-0">
                        <div class="form-group  row p-1 ">
                            <div class="col-sm-4">Fecha</div>
                            <div class="col-sm-4">
                                <input class="form-control x_datepicker" type="text" name="fecha" value="" required="">
                                <input type="hidden" name="codigo" value="{{ caso_desaparecido.codigo }}">
                            </div>
                        </div>
                    </div>
                    <div class="col-sm p-0">                
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm p-0">
                        <div class="form-group  row p-1 ">
                            <div class="col-sm-4">Estado</div>
                            <div class="col-sm-8">
                                <select class="form-control" id="estado" name="estado" style="max-width:265px;" required>
                                    <option value="">Seleccionar...</option>
                                    {% for estado_item in estados_siguientes %}
                                        <option value="{{ estado_item.id }}">{{ estado_item.estado }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm p-0">                
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm p-0">
                        <div class="form-group  row p-1 " id="fila-institucion" style="display: none;">
                            <div class="col-sm-4">Institución</div>
                            <div class="col-sm-8">
                                <select class="form-control" id="institucion" name="institucion" style="max-width:265px;">
                                    <option></option>
                                    {% for inst in institucion %}
                                        <option value="{{ inst.id }}">{{ inst.name }}</option>
                                   {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm p-0">                
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm p-0">
                        <div class="form-group  row p-1 ">
                            <div class="col-sm-4">Descripción</div>
                            <div class="col-sm-8">
                                        <textarea name="descripcion" id="descripcion" class="form-control" rows="5" ></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm p-0">                
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm p-0">
                        <div class="form-group  row p-1 ">
                            <div class="col-sm-4"></div>
                            <div class="col-sm-8">
                                <div class="text-end">
                                    <button class="btn btn-warning m-btn m-btn--custom m-btn--icon ">
                                        <span><i class="fa flaticon-folder-2"></i><span>Registrar</span></span>    
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm p-0">                
                    </div>
                </div>
                
            </div>
        </form>
    {% endif %}


{% endblock %}

{% block _main_tools %}
    <button type="button" onclick="imprimir()"
            class="btn-print btn btn-light-primary px-6 font-weight-bold mr-2">
        <i class="fas fa-print"></i>
        Imprimir
    </button>
{% endblock %}

{% block _main_footer %}

{% endblock %}

{% block _main_actions %}
{% endblock %}

{% block _javascripts %}
    <script>
        function imprimir() {
            window.print();
        }

        document.addEventListener('DOMContentLoaded', function () {
            const estadoSelect = document.getElementById('estado');
            const institucionFila = document.getElementById('fila-institucion');

            estadoSelect.addEventListener('change', function () {
                if (this.options[this.selectedIndex].text === 'Derivado') {
                    institucionFila.style.display = '';
                } else {
                    institucionFila.style.display = 'none';
                }
            });
        });
    </script>

{% endblock %}

{% block _stylesheets %}
    <style>
        @media print {
            .btn-print, .oculto-impresion * {
                display: none !important;
            }
        }
    </style>

{% endblock %}