!function(n){"use strict";var e,t,r,o,i=tinymce.util.Tools.resolve("tinymce.PluginManager"),u=function(){},a=function(n){return function(){return n}},s=function(n){return function(e){return!n(e)}},c=a(!1),f=a(!0),d=function(){return l},l=function(){var n=function(n){return n.isNone()},e=function(n){return n()},t=function(n){return n};return{fold:function(n,e){return n()},is:c,isSome:c,isNone:f,getOr:t,getOrThunk:e,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:a(null),getOrUndefined:a(void 0),or:t,orThunk:e,map:d,each:u,bind:d,exists:c,forall:f,filter:d,equals:n,equals_:n,toArray:function(){return[]},toString:a("none()")}}(),m=function(n){var e=a(n),t=function(){return o},r=function(e){return e(n)},o={fold:function(e,t){return t(n)},is:function(e){return n===e},isSome:f,isNone:c,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:t,orThunk:t,map:function(e){return m(e(n))},each:function(e){e(n)},bind:r,exists:r,forall:r,filter:function(e){return e(n)?o:l},toArray:function(){return[n]},toString:function(){return"some("+n+")"},equals:function(e){return e.is(n)},equals_:function(e,t){return e.fold(c,function(e){return t(n,e)})}};return o},p={some:m,none:d,from:function(n){return null==n?l:m(n)}},g=function(n){return function(e){return r=typeof(t=e),(null===t?"null":"object"===r&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"===r&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":r)===n;var t,r}},v=function(n){return function(e){return typeof e===n}},h=g("string"),y=g("array"),S=v("boolean"),C=v("function"),b=v("number"),O=Array.prototype.slice,N=Array.prototype.push,L=function(n,e){for(var t=n.length,r=new Array(t),o=0;o<t;o++){var i=n[o];r[o]=e(i,o)}return r},w=function(n,e){for(var t=0,r=n.length;t<r;t++){e(n[t],t)}},T=function(n,e){for(var t=[],r=0,o=n.length;r<o;r++){var i=n[r];e(i,r)&&t.push(i)}return t},D=function(n,e,t){return w(n,function(n){t=e(t,n)}),t},k=function(n,e,t){for(var r=0,o=n.length;r<o;r++){var i=n[r];if(e(i,r))return p.some(i);if(t(i,r))break}return p.none()},x=function(n,e){return k(n,e,c)},A=function(n,e){return function(n){for(var e=[],t=0,r=n.length;t<r;++t){if(!y(n[t]))throw new Error("Arr.flatten item "+t+" was not an array, input: "+n);N.apply(e,n[t])}return e}(L(n,e))},E=function(n){var e=O.call(n,0);return e.reverse(),e},B=function(n){return 0===n.length?p.none():p.some(n[0])},I=function(n){return 0===n.length?p.none():p.some(n[n.length-1])},R=function(){return(R=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}).apply(this,arguments)},P=function(){return M(0,0)},M=function(n,e){return{major:n,minor:e}},U={nu:M,detect:function(n,e){var t=String(e).toLowerCase();return 0===n.length?P():function(n,e){var t=function(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(r.test(e))return r}}(n,e);if(!t)return{major:0,minor:0};var r=function(n){return Number(e.replace(t,"$"+n))};return M(r(1),r(2))}(n,t)},unknown:P},_=function(n){var e=n.current,t=n.version,r=function(n){return function(){return e===n}};return{current:e,version:t,isEdge:r("Edge"),isChrome:r("Chrome"),isIE:r("IE"),isOpera:r("Opera"),isFirefox:r("Firefox"),isSafari:r("Safari")}},F={unknown:function(){return _({current:void 0,version:U.unknown()})},nu:_,edge:a("Edge"),chrome:a("Chrome"),ie:a("IE"),opera:a("Opera"),firefox:a("Firefox"),safari:a("Safari")},$=function(n){var e=n.current,t=n.version,r=function(n){return function(){return e===n}};return{current:e,version:t,isWindows:r("Windows"),isiOS:r("iOS"),isAndroid:r("Android"),isOSX:r("OSX"),isLinux:r("Linux"),isSolaris:r("Solaris"),isFreeBSD:r("FreeBSD"),isChromeOS:r("ChromeOS")}},H={unknown:function(){return $({current:void 0,version:U.unknown()})},nu:$,windows:a("Windows"),ios:a("iOS"),android:a("Android"),linux:a("Linux"),osx:a("OSX"),solaris:a("Solaris"),freebsd:a("FreeBSD"),chromeos:a("ChromeOS")},j=function(n,e){var t=String(e).toLowerCase();return x(n,function(n){return n.search(t)})},q=function(n,e){return j(n,e).map(function(n){var t=U.detect(n.versionRegexes,e);return{current:n.name,version:t}})},W=function(n,e){return j(n,e).map(function(n){var t=U.detect(n.versionRegexes,e);return{current:n.name,version:t}})},K=function(n,e){return-1!==n.indexOf(e)},V=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,Q=function(n){return function(e){return K(e,n)}},X=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return K(n,"edge/")&&K(n,"chrome")&&K(n,"safari")&&K(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,V],search:function(n){return K(n,"chrome")&&!K(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return K(n,"msie")||K(n,"trident")}},{name:"Opera",versionRegexes:[V,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:Q("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:Q("firefox")},{name:"Safari",versionRegexes:[V,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(K(n,"safari")||K(n,"mobile/"))&&K(n,"applewebkit")}}],z=[{name:"Windows",search:Q("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return K(n,"iphone")||K(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:Q("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:Q("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:Q("linux"),versionRegexes:[]},{name:"Solaris",search:Q("sunos"),versionRegexes:[]},{name:"FreeBSD",search:Q("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:Q("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],Y={browsers:a(X),oses:a(z)},G=function(n,e){var t=Y.browsers(),r=Y.oses(),o=q(t,n).fold(F.unknown,F.nu),i=W(r,n).fold(H.unknown,H.nu),u=function(n,e,t,r){var o=n.isiOS()&&!0===/ipad/i.test(t),i=n.isiOS()&&!o,u=n.isiOS()||n.isAndroid(),s=u||r("(pointer:coarse)"),c=o||!i&&u&&r("(min-device-width:768px)"),f=i||u&&!c,d=e.isSafari()&&n.isiOS()&&!1===/safari/i.test(t),l=!f&&!c&&!d;return{isiPad:a(o),isiPhone:a(i),isTablet:a(c),isPhone:a(f),isTouch:a(s),isAndroid:n.isAndroid,isiOS:n.isiOS,isWebView:a(d),isDesktop:a(l)}}(i,o,n,e);return{browser:o,os:i,deviceType:u}},J=function(e){return n.window.matchMedia(e).matches},Z=(e=function(){return G(n.navigator.userAgent,J)},r=!1,function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return r||(r=!0,t=e.apply(null,n)),t}),nn=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:a(n)}},en={fromHtml:function(e,t){var r=(t||n.document).createElement("div");if(r.innerHTML=e,!r.hasChildNodes()||r.childNodes.length>1)throw n.console.error("HTML does not have a single root node",e),new Error("HTML must have a single root node");return nn(r.childNodes[0])},fromTag:function(e,t){var r=(t||n.document).createElement(e);return nn(r)},fromText:function(e,t){var r=(t||n.document).createTextNode(e);return nn(r)},fromDom:nn,fromPoint:function(n,e,t){var r=n.dom();return p.from(r.elementFromPoint(e,t)).map(nn)}},tn=function(n,e){return n.dom()===e.dom()},rn=function(e,t){return r=e.dom(),o=t.dom(),function(n,e,t){return 0!=(n.compareDocumentPosition(e)&t)}(r,o,n.Node.DOCUMENT_POSITION_CONTAINED_BY);var r,o},on=function(n,e){return Z().browser.isIE()?rn(n,e):function(n,e){var t=n.dom(),r=e.dom();return t!==r&&t.contains(r)}(n,e)},un=function(n,e){var t=n.dom();if(1!==t.nodeType)return!1;var r=t;if(void 0!==r.matches)return r.matches(e);if(void 0!==r.msMatchesSelector)return r.msMatchesSelector(e);if(void 0!==r.webkitMatchesSelector)return r.webkitMatchesSelector(e);if(void 0!==r.mozMatchesSelector)return r.mozMatchesSelector(e);throw new Error("Browser lacks native selectors")},an=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),sn=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),cn=tinymce.util.Tools.resolve("tinymce.util.VK"),fn=function(n,e,t){return n.isSome()&&e.isSome()?p.some(t(n.getOrDie(),e.getOrDie())):p.none()},dn=function(n){return p.from(n.dom().parentNode).map(en.fromDom)},ln=function(n){return L(n.dom().childNodes,en.fromDom)},mn=function(n,e){var t=n.dom().childNodes;return p.from(t[e]).map(en.fromDom)},pn=function(n){return mn(n,0)},gn=function(n){return mn(n,n.dom().childNodes.length-1)},vn=function(n,e){dn(n).each(function(t){t.dom().insertBefore(e.dom(),n.dom())})},hn=function(n,e){n.dom().appendChild(e.dom())},yn=function(n,e){w(e,function(e){hn(n,e)})},Sn=function(n){var e=n.dom();null!==e.parentNode&&e.parentNode.removeChild(e)},Cn=function(n,e,t){return n.fire("ListMutation",{action:e,element:t})},bn=(void 0!==n.window?n.window:Function("return this;")(),tinymce.util.Tools.resolve("tinymce.dom.DomQuery")),On=tinymce.util.Tools.resolve("tinymce.util.Tools"),Nn=function(n){return function(e){return e&&e.nodeName.toLowerCase()===n}},Ln=function(n){return function(e){return e&&n.test(e.nodeName)}},wn=function(n){return n&&3===n.nodeType},Tn=Ln(/^(OL|UL|DL)$/),Dn=Ln(/^(OL|UL)$/),kn=Nn("ol"),xn=Ln(/^(LI|DT|DD)$/),An=Ln(/^(DT|DD)$/),En=Ln(/^(TH|TD)$/),Bn=Nn("br"),In=function(n,e){return e&&!!n.schema.getTextBlockElements()[e.nodeName]},Rn=function(n,e){return n&&n.nodeName in e},Pn=function(n,e,t){var r=n.isEmpty(e);return!(t&&n.select("span[data-mce-type=bookmark]",e).length>0)&&r},Mn=function(n,e){return n.isChildOf(e,n.getRoot())},Un=function(n,e){var t=e||n.selection.getStart(!0);return n.dom.getParent(t,"OL,UL,DL",$n(n,t))},_n=function(n){var e=Un(n),t=n.selection.getSelectedBlocks();return function(n,e){return n&&1===e.length&&e[0]===n}(e,t)?function(n){return On.grep(n.querySelectorAll("ol,ul,dl"),function(n){return Tn(n)})}(e):On.grep(t,function(n){return Tn(n)&&e!==n})},Fn=function(n){var e=n.selection.getSelectedBlocks();return On.grep(function(n,e){var t=On.map(e,function(e){var t=n.dom.getParent(e,"li,dd,dt",$n(n,e));return t||e});return bn.unique(t)}(n,e),function(n){return xn(n)})},$n=function(n,e){var t=n.dom.getParents(e,"TD,TH");return t.length>0?t[0]:n.getBody()},Hn=function(n,e){var t=n.dom.getParents(e,"ol,ul",$n(n,e));return I(t)},jn=function(n){var e=function(n){var e=Hn(n,n.selection.getStart()),t=T(n.selection.getSelectedBlocks(),Dn);return e.toArray().concat(t)}(n);return qn(n,e)},qn=function(n,e){var t=L(e,function(e){return Hn(n,e).getOr(e)});return bn.unique(t)},Wn=function(n,e){var t,r,o,i=n.dom,u=n.schema.getBlockElements(),a=i.createFragment(),s=function(n){var e=n.getParam("forced_root_block","p");return!1===e?"":!0===e?"p":e}(n);if(s&&((r=i.create(s)).tagName===s.toUpperCase()&&i.setAttribs(r,function(n){return n.getParam("forced_root_block_attrs",{})}(n)),Rn(e.firstChild,u)||a.appendChild(r)),e)for(;t=e.firstChild;){var c=t.nodeName;o||"SPAN"===c&&"bookmark"===t.getAttribute("data-mce-type")||(o=!0),Rn(t,u)?(a.appendChild(t),r=null):s?(r||(r=i.create(s),a.appendChild(r)),r.appendChild(t)):a.appendChild(t)}return s?o||r.appendChild(i.create("br",{"data-mce-bogus":"1"})):a.appendChild(i.create("br")),a},Kn=Object.keys,Vn=function(n,e){for(var t=Kn(n),r=0,o=t.length;r<o;r++){var i=t[r];e(n[i],i)}},Qn=function(n,e){var t,r={};return function(n,e,t,r){Vn(n,function(n,o){(e(n,o)?t:r)(n,o)})}(n,e,(t=r,function(n,e){t[e]=n}),u),r},Xn=function(n){return n.dom().nodeName.toLowerCase()},zn=(o=1,function(n){return function(n){return n.dom().nodeType}(n)===o}),Yn=function(e,t){var r=e.dom();Vn(t,function(e,t){!function(e,t,r){if(!(h(r)||S(r)||b(r)))throw n.console.error("Invalid call to Attr.set. Key ",t,":: Value ",r,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,r+"")}(r,t,e)})},Gn=function(n){return D(n.dom().attributes,function(n,e){return n[e.name]=e.value,n},{})},Jn=function(e,t,r){if(!h(r))throw n.console.error("Invalid call to CSS.set. Property ",t,":: Value ",r,":: Element ",e),new Error("CSS value must be a string: "+r);(function(n){return void 0!==n.style&&C(n.style.getPropertyValue)})(e)&&e.style.setProperty(t,r)},Zn=function(n){return function(n,e){return en.fromDom(n.dom().cloneNode(e))}(n,!0)},ne=function(n,e){var t=function(n,e){var t=en.fromTag(e),r=Gn(n);return Yn(t,r),t}(n,e);vn(n,t);var r=ln(n);return yn(t,r),Sn(n),t},ee=function(n,e){hn(n.item,e.list)},te=function(n,e){var t={list:en.fromTag(e,n),item:en.fromTag("li",n)};return hn(t.list,t.item),t},re=function(n,e,t){var r=e.slice(0,t.depth);return I(r).each(function(e){!function(n,e){hn(n.list,e),n.item=e}(e,function(n,e,t){var r=en.fromTag("li",n);return Yn(r,e),yn(r,t),r}(n,t.itemAttributes,t.content)),function(n,e){Xn(n.list)!==e.listType&&(n.list=ne(n.list,e.listType)),Yn(n.list,e.listAttributes)}(e,t)}),r},oe=function(n,e,t){var r,o=function(n,e,t){for(var r=[],o=0;o<t;o++)r.push(te(n,e.listType));return r}(n,t,t.depth-e.length);return function(n){for(var e=1;e<n.length;e++)ee(n[e-1],n[e])}(o),function(n,e){for(var t=0;t<n.length-1;t++)r=n[t].item,o="list-style-type",i="none",u=void 0,u=r.dom(),Jn(u,o,i);var r,o,i,u;I(n).each(function(n){Yn(n.list,e.listAttributes),Yn(n.item,e.itemAttributes),yn(n.item,e.content)})}(o,t),r=o,fn(I(e),B(r),ee),e.concat(o)},ie=function(n){return un(n,"OL,UL")},ue=function(n){return pn(n).map(ie).getOr(!1)},ae=function(n){return n.depth>0},se=function(n){return n.isSelected},ce=function(n){var e=ln(n),t=gn(n).map(ie).getOr(!1)?e.slice(0,-1):e;return L(t,Zn)},fe=function(n){return w(n,function(e,t){(function(n,e){var t=n[e].depth,r=function(n){return n.depth===t&&!n.dirty},o=function(n){return n.depth<t};return k(E(n.slice(0,e)),r,o).orThunk(function(){return k(n.slice(e+1),r,o)})})(n,t).fold(function(){e.dirty&&function(n){n.listAttributes=Qn(n.listAttributes,function(n,e){return"start"!==e})}(e)},function(n){return r=n,(t=e).listType=r.listType,void(t.listAttributes=R({},r.listAttributes));var t,r})}),n},de=function(n,e,t,r){return pn(r).filter(ie).fold(function(){e.each(function(n){tn(n.start,r)&&t.set(!0)});var o=function(n,e,t){return dn(n).filter(zn).map(function(r){return{depth:e,dirty:!1,isSelected:t,content:ce(n),itemAttributes:Gn(n),listAttributes:Gn(r),listType:Xn(r)}})}(r,n,t.get());e.each(function(n){tn(n.end,r)&&t.set(!1)});var i=gn(r).filter(ie).map(function(r){return le(n,e,t,r)}).getOr([]);return o.toArray().concat(i)},function(r){return le(n,e,t,r)})},le=function(n,e,t,r){return A(ln(r),function(r){return(ie(r)?le:de)(n+1,e,t,r)})},me=function(e,t){var r=fe(t);return L(r,function(t){var r,o,i,u=(r=t.content,i=(o||n.document).createDocumentFragment(),w(r,function(n){i.appendChild(n.dom())}),en.fromDom(i));return en.fromDom(Wn(e,u.dom()))})},pe=function(n,e){var t=fe(e);return function(n,e){var t=D(e,function(e,t){return t.depth>e.length?oe(n,e,t):re(n,e,t)},[]);return B(t).map(function(n){return n.list})}(n.contentDocument,t).toArray()},ge=function(n,e,t){var r=function(n,e){var t,r=(t=!1,{get:function(){return t},set:function(n){t=n}});return L(n,function(n){return{sourceList:n,entries:le(0,e,r,n)}})}(e,function(n){var e=L(Fn(n),en.fromDom);return fn(x(e,s(ue)),x(E(e),s(ue)),function(n,e){return{start:n,end:e}})}(n));w(r,function(e){!function(n,e){w(T(n,se),function(n){return function(n,e){switch(n){case"Indent":e.depth++;break;case"Outdent":e.depth--;break;case"Flatten":e.depth=0}e.dirty=!0}(e,n)})}(e.entries,t);var r,o=function(n,e){return A(function(n,e){if(0===n.length)return[];for(var t=e(n[0]),r=[],o=[],i=0,u=n.length;i<u;i++){var a=n[i],s=e(a);s!==t&&(r.push(o),o=[]),t=s,o.push(a)}return 0!==o.length&&r.push(o),r}(e,ae),function(e){return B(e).map(ae).getOr(!1)?pe(n,e):me(n,e)})}(n,e.entries);w(o,function(e){Cn(n,"Indent"===t?"IndentList":"OutdentList",e.dom())}),r=e.sourceList,w(o,function(n){vn(r,n)}),Sn(e.sourceList)})},ve=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),he=ve.DOM,ye=function(n,e){un(e,"dd")?ne(e,"dt"):un(e,"dt")&&dn(e).each(function(t){return function(n,e,t){var r,o,i,u,a,s;for(i=he.select('span[data-mce-type="bookmark"]',e),a=Wn(n,t),(r=he.createRng()).setStartAfter(t),r.setEndAfter(e),u=(o=r.extractContents()).firstChild;u;u=u.firstChild)if("LI"===u.nodeName&&n.dom.isEmpty(u)){he.remove(u);break}n.dom.isEmpty(o)||he.insertAfter(o,e),he.insertAfter(a,e),Pn(n.dom,t.parentNode)&&(s=t.parentNode,On.each(i,function(n){s.parentNode.insertBefore(n,t.parentNode)}),he.remove(s)),he.remove(t),Pn(n.dom,e)&&he.remove(e)}(n,t.dom(),e.dom())})},Se=function(n){un(n,"dt")&&ne(n,"dd")},Ce=function(n,e){if(wn(n))return{container:n,offset:e};var t=an.getNode(n,e);return wn(t)?{container:t,offset:e>=n.childNodes.length?t.data.length:0}:t.previousSibling&&wn(t.previousSibling)?{container:t.previousSibling,offset:t.previousSibling.data.length}:t.nextSibling&&wn(t.nextSibling)?{container:t.nextSibling,offset:0}:{container:n,offset:e}},be=function(n){var e=n.cloneRange(),t=Ce(n.startContainer,n.startOffset);e.setStart(t.container,t.offset);var r=Ce(n.endContainer,n.endOffset);return e.setEnd(r.container,r.offset),e},Oe=function(n,e){var t=L(jn(n),en.fromDom),r=L(function(n){return T(Fn(n),An)}(n),en.fromDom),o=!1;if(t.length||r.length){var i=n.selection.getBookmark();ge(n,t,e),function(n,e,t){w(t,"Indent"===e?Se:function(e){return ye(n,e)})}(n,e,r),n.selection.moveToBookmark(i),n.selection.setRng(be(n.selection.getRng())),n.nodeChanged(),o=!0}return o},Ne=function(n){return Oe(n,"Indent")},Le=function(n){return Oe(n,"Outdent")},we=function(n){return Oe(n,"Flatten")},Te=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager"),De=ve.DOM,ke=function(n){var e={},t=function(t){var r,o,i;o=n[t?"startContainer":"endContainer"],i=n[t?"startOffset":"endOffset"],1===o.nodeType&&(r=De.create("span",{"data-mce-type":"bookmark"}),o.hasChildNodes()?(i=Math.min(i,o.childNodes.length-1),t?o.insertBefore(r,o.childNodes[i]):De.insertAfter(r,o.childNodes[i])):o.appendChild(r),o=r,i=0),e[t?"startContainer":"endContainer"]=o,e[t?"startOffset":"endOffset"]=i};return t(!0),n.collapsed||t(),e},xe=function(n){function e(e){var t,r,o;t=o=n[e?"startContainer":"endContainer"],r=n[e?"startOffset":"endOffset"],t&&(1===t.nodeType&&(r=function(n){for(var e=n.parentNode.firstChild,t=0;e;){if(e===n)return t;1===e.nodeType&&"bookmark"===e.getAttribute("data-mce-type")||t++,e=e.nextSibling}return-1}(t),t=t.parentNode,De.remove(o),!t.hasChildNodes()&&De.isBlock(t)&&t.appendChild(De.create("br"))),n[e?"startContainer":"endContainer"]=t,n[e?"startOffset":"endOffset"]=r)}e(!0),e();var t=De.createRng();return t.setStart(n.startContainer,n.startOffset),n.endContainer&&t.setEnd(n.endContainer,n.endOffset),be(t)},Ae=function(n){return/\btox\-/.test(n.className)},Ee=function(n,e,t){return function(){var r=function(n){var r=k(n.parents,Tn,En).filter(function(n){return n.nodeName===e&&!Ae(n)}).isSome();t(r)};return n.on("NodeChange",r),function(){return n.off("NodeChange",r)}}},Be=function(n){switch(n){case"UL":return"ToggleUlList";case"OL":return"ToggleOlList";case"DL":return"ToggleDLList"}},Ie=function(n,e){On.each(e,function(e,t){n.setAttribute(t,e)})},Re=function(n,e,t){!function(n,e,t){var r=t["list-style-type"]?t["list-style-type"]:null;n.setStyle(e,"list-style-type",r)}(n,e,t),function(n,e,t){Ie(e,t["list-attributes"]),On.each(n.select("li",e),function(n){Ie(n,t["list-item-attributes"])})}(n,e,t)},Pe=function(n,e,t,r){var o,i;for(o=e[t?"startContainer":"endContainer"],i=e[t?"startOffset":"endOffset"],1===o.nodeType&&(o=o.childNodes[Math.min(i,o.childNodes.length-1)]||o),!t&&Bn(o.nextSibling)&&(o=o.nextSibling);o.parentNode!==r;){if(In(n,o))return o;if(/^(TD|TH)$/.test(o.parentNode.nodeName))return o;o=o.parentNode}return o},Me=function(n,e,t){void 0===t&&(t={});var r,o=n.selection.getRng(!0),i="LI",u=$n(n,n.selection.getStart(!0)),a=n.dom;"false"!==a.getContentEditable(n.selection.getNode())&&("DL"===(e=e.toUpperCase())&&(i="DT"),r=ke(o),On.each(function(n,e,t){for(var r,o=[],i=n.dom,u=Pe(n,e,!0,t),a=Pe(n,e,!1,t),s=[],c=u;c&&(s.push(c),c!==a);c=c.nextSibling);return On.each(s,function(e){if(In(n,e))return o.push(e),void(r=null);if(i.isBlock(e)||Bn(e))return Bn(e)&&i.remove(e),void(r=null);var u=e.nextSibling;Te.isBookmarkNode(e)&&(In(n,u)||!u&&e.parentNode===t)?r=null:(r||(r=i.create("p"),e.parentNode.insertBefore(r,e),o.push(r)),r.appendChild(e))}),o}(n,o,u),function(r){var o,u;(u=r.previousSibling)&&Tn(u)&&u.nodeName===e&&function(n,e,t){var r=n.getStyle(e,"list-style-type"),o=t?t["list-style-type"]:"";return r===(o=null===o?"":o)}(a,u,t)?(o=u,r=a.rename(r,i),u.appendChild(r)):(o=a.create(e),r.parentNode.insertBefore(o,r),o.appendChild(r),r=a.rename(r,i)),function(n,e,t){On.each(t,function(t){var r;return n.setStyle(e,((r={})[t]="",r))})}(a,r,["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"]),Re(a,o,t),_e(n.dom,o)}),n.selection.setRng(xe(r)))},Ue=function(n,e,t){return function(n,e){return n&&e&&Tn(n)&&n.nodeName===e.nodeName}(e,t)&&function(n,e,t){return n.getStyle(e,"list-style-type",!0)===n.getStyle(t,"list-style-type",!0)}(n,e,t)&&(r=t,e.className===r.className);var r},_e=function(n,e){var t,r;if(t=e.nextSibling,Ue(n,e,t)){for(;r=t.firstChild;)e.appendChild(r);n.remove(t)}if(t=e.previousSibling,Ue(n,e,t)){for(;r=t.lastChild;)e.insertBefore(r,e.firstChild);n.remove(t)}},Fe=function(n,e,t,r,o){if(e.nodeName!==r||$e(o)){var i=ke(n.selection.getRng(!0));On.each([e].concat(t),function(e){!function(n,e,t,r){if(e.nodeName!==t){var o=n.dom.rename(e,t);Re(n.dom,o,r),Cn(n,Be(t),o)}else Re(n.dom,e,r),Cn(n,Be(t),e)}(n,e,r,o)}),n.selection.setRng(xe(i))}else we(n)},$e=function(n){return"list-style-type"in n},He=function(n,e,t){var r=Un(n),o=_n(n);t=t||{},r&&o.length>0?Fe(n,r,o,e,t):function(n,e,t,r){if(e!==n.getBody())if(e)if(e.nodeName!==t||$e(r)||Ae(e)){var o=ke(n.selection.getRng(!0));Re(n.dom,e,r);var i=n.dom.rename(e,t);_e(n.dom,i),n.selection.setRng(xe(o)),Cn(n,Be(t),i)}else we(n);else Me(n,t,r),Cn(n,Be(t),e)}(n,r,e,t)},je=ve.DOM,qe=function(n,e){On.each(On.grep(n.select("ol,ul",e)),function(e){!function(n,e){var t,r=e.parentNode;"LI"===r.nodeName&&r.firstChild===e&&((t=r.previousSibling)&&"LI"===t.nodeName?(t.appendChild(e),Pn(n,r)&&je.remove(r)):je.setStyle(r,"listStyleType","none")),Tn(r)&&(t=r.previousSibling)&&"LI"===t.nodeName&&t.appendChild(e)}(n,e)})},We=function(n,e,t,r){var o=e.startContainer,i=e.startOffset;if(wn(o)&&(t?i<o.data.length:i>0))return o;var u=n.schema.getNonEmptyElements();1===o.nodeType&&(o=an.getNode(o,i));var a=new sn(o,r);for(t&&function(n,e){return!!Bn(e)&&!(!n.isBlock(e.nextSibling)||Bn(e.previousSibling))}(n.dom,o)&&a.next();o=a[t?"next":"prev2"]();){if("LI"===o.nodeName&&!o.hasChildNodes())return o;if(u[o.nodeName])return o;if(wn(o)&&o.data.length>0)return o}},Ke=function(n,e){var t=e.childNodes;return 1===t.length&&!Tn(t[0])&&n.isBlock(t[0])},Ve=function(n,e,t){var r,o;if(o=Ke(n,t)?t.firstChild:t,function(n,e){Ke(n,e)&&n.remove(e.firstChild,!0)}(n,e),!Pn(n,e,!0))for(;r=e.firstChild;)o.appendChild(r)},Qe=function(n,e,t){var r,o,i=e.parentNode;if(Mn(n,e)&&Mn(n,t)){Tn(t.lastChild)&&(o=t.lastChild),i===t.lastChild&&Bn(i.previousSibling)&&n.remove(i.previousSibling),(r=t.lastChild)&&Bn(r)&&e.hasChildNodes()&&n.remove(r),Pn(n,t,!0)&&n.$(t).empty(),Ve(n,e,t),o&&t.appendChild(o);var u=on(en.fromDom(t),en.fromDom(e))?n.getParents(e,Tn,t):[];n.remove(e),w(u,function(e){Pn(n,e)&&e!==n.getRoot()&&n.remove(e)})}},Xe=function(n,e,t,r){var o=n.dom;if(o.isEmpty(r))!function(n,e,t){n.dom.$(t).empty(),Qe(n.dom,e,t),n.selection.setCursorLocation(t)}(n,t,r);else{var i=ke(e);Qe(o,t,r),n.selection.setRng(xe(i))}},ze=function(n,e){var t=n.dom,r=n.selection,o=r.getStart(),i=$n(n,o),u=t.getParent(r.getStart(),"LI",i);if(u){var a=u.parentNode;if(a===n.getBody()&&Pn(t,a))return!0;var s=be(r.getRng()),c=t.getParent(We(n,s,e,i),"LI",i);if(c&&c!==u)return n.undoManager.transact(function(){var t;e?Xe(n,s,c,u):(t=u).parentNode.firstChild===t?Le(n):function(n,e,t,r){var o=ke(e);Qe(n.dom,t,r);var i=xe(o);n.selection.setRng(i)}(n,s,u,c)}),!0;if(!c&&!e&&0===s.startOffset&&0===s.endOffset)return n.undoManager.transact(function(){we(n)}),!0}return!1},Ye=function(n,e){return ze(n,e)||function(n,e){var t=n.dom,r=n.selection.getStart(),o=$n(n,r),i=t.getParent(r,t.isBlock,o);if(i&&t.isEmpty(i)){var u=be(n.selection.getRng()),a=t.getParent(We(n,u,e,o),"LI",o);if(a)return n.undoManager.transact(function(){!function(n,e,t){var r=n.getParent(e.parentNode,n.isBlock,t);n.remove(e),r&&n.isEmpty(r)&&n.remove(r)}(t,i,o),_e(t,a.parentNode),n.selection.select(a,!0),n.selection.collapse(e)}),!0}return!1}(n,e)},Ge=function(n,e){return n.selection.isCollapsed()?Ye(n,e):function(n){var e=n.selection.getStart(),t=$n(n,e);return!!(n.dom.getParent(e,"LI,DT,DD",t)||Fn(n).length>0)&&(n.undoManager.transact(function(){n.execCommand("Delete"),qe(n.dom,n.getBody())}),!0)}(n)},Je=function(n){return{backspaceDelete:function(e){Ge(n,e)}}},Ze=function(n){var e=n.dom,t=Un(n);kn(t)&&n.windowManager.open({title:"List Properties",body:{type:"panel",items:[{type:"input",name:"start",label:"Start list at number",inputMode:"numeric"}]},initialData:{start:e.getAttrib(t,"start")||"1"},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:function(t){var r=t.getData();n.undoManager.transact(function(){e.setAttrib(Un(n),"start","1"===r.start?"":r.start)}),t.close()}})},nt=function(n,e){return function(){var t=n.dom.getParent(n.selection.getStart(),"UL,OL,DL");return t&&t.nodeName===e}},et=function(n){n.on("BeforeExecCommand",function(e){var t=e.command.toLowerCase();"indent"===t?Ne(n):"outdent"===t&&Le(n)}),n.addCommand("InsertUnorderedList",function(e,t){He(n,"UL",t)}),n.addCommand("InsertOrderedList",function(e,t){He(n,"OL",t)}),n.addCommand("InsertDefinitionList",function(e,t){He(n,"DL",t)}),n.addCommand("RemoveList",function(){we(n)}),n.addCommand("mceListProps",function(){Ze(n)}),n.addQueryStateHandler("InsertUnorderedList",nt(n,"UL")),n.addQueryStateHandler("InsertOrderedList",nt(n,"OL")),n.addQueryStateHandler("InsertDefinitionList",nt(n,"DL"))},tt=function(n){return!(!/(^|[ ,])rtc([, ]|$)/.test(n.settings.plugins)||!i.get("rtc"))},rt=function(n){(function(n){return n.getParam("lists_indent_on_tab",!0)})(n)&&function(n){n.on("keydown",function(e){e.keyCode!==cn.TAB||cn.metaKeyPressed(e)||n.undoManager.transact(function(){(e.shiftKey?Le(n):Ne(n))&&e.preventDefault()})})}(n),function(n){n.on("keydown",function(e){e.keyCode===cn.BACKSPACE?Ge(n,!1)&&e.preventDefault():e.keyCode===cn.DELETE&&Ge(n,!0)&&e.preventDefault()})}(n)},ot=function(n){var e=function(e){return function(){return n.execCommand(e)}};(function(n,e){var t=n.settings.plugins?n.settings.plugins:"";return-1!==On.inArray(t.split(/[ ,]/),e)})(n,"advlist")||(n.ui.registry.addToggleButton("numlist",{icon:"ordered-list",active:!1,tooltip:"Numbered list",onAction:e("InsertOrderedList"),onSetup:function(e){return Ee(n,"OL",e.setActive)}}),n.ui.registry.addToggleButton("bullist",{icon:"unordered-list",active:!1,tooltip:"Bullet list",onAction:e("InsertUnorderedList"),onSetup:function(e){return Ee(n,"UL",e.setActive)}}))},it=function(n){var e={text:"List properties...",icon:"ordered-list",onAction:function(){return Ze(n)},onSetup:function(e){return Ee(n,"OL",function(n){return e.setDisabled(!n)})}};n.ui.registry.addMenuItem("listprops",e),n.ui.registry.addContextMenu("lists",{update:function(e){var t=Un(n,e);return kn(t)?["listprops"]:[]}})};i.add("lists",function(n){return!1===tt(n)&&(rt(n),et(n)),ot(n),it(n),Je(n)})}(window);