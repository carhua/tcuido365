!function(e){"use strict";var t,n,r,o,i,a,u=tinymce.util.Tools.resolve("tinymce.PluginManager"),s=function(){},c=function(e){return function(){return e}},f=function(e){return function(t){return!e(t)}},d=c(!1),l=c(!0),m=function(){return p},p=(t=function(e){return e.isNone()},{fold:function(e,t){return e()},is:d,isSome:d,isNone:l,getOr:r=function(e){return e},getOrThunk:n=function(e){return e()},getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:c(null),getOrUndefined:c(void 0),or:r,orThunk:n,map:m,each:s,bind:m,exists:d,forall:l,filter:m,equals:t,equals_:t,toArray:function(){return[]},toString:c("none()")}),g=function(e){var t=c(e),n=function(){return o},r=function(t){return t(e)},o={fold:function(t,n){return n(e)},is:function(t){return e===t},isSome:l,isNone:d,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:n,orThunk:n,map:function(t){return g(t(e))},each:function(t){t(e)},bind:r,exists:r,forall:r,filter:function(t){return t(e)?o:p},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(t){return t.is(e)},equals_:function(t,n){return t.fold(d,function(t){return n(e,t)})}};return o},v={some:g,none:m,from:function(e){return null==e?p:g(e)}},h=function(e){return function(t){return r=typeof(n=t),(null===n?"null":"object"==r&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==r&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":r)===e;var n,r}},y=function(e){return function(t){return typeof t===e}},S=h("string"),b=h("array"),C=y("boolean"),O=y("function"),N=y("number"),L=Array.prototype.slice,T=Array.prototype.push,k=function(e,t){for(var n=e.length,r=new Array(n),o=0;o<n;o++){var i=e[o];r[o]=t(i,o)}return r},x=function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)},A=function(e,t){for(var n=[],r=0,o=e.length;r<o;r++){var i=e[r];t(i,r)&&n.push(i)}return n},w=function(e,t,n){return x(e,function(e){n=t(n,e)}),n},D=function(e,t,n){for(var r=0,o=e.length;r<o;r++){var i=e[r];if(t(i,r))return v.some(i);if(n(i,r))break}return v.none()},E=function(e,t){return D(e,t,d)},B=function(e,t){return function(e){for(var t=[],n=0,r=e.length;n<r;++n){if(!b(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);T.apply(t,e[n])}return t}(k(e,t))},I=function(e){var t=L.call(e,0);return t.reverse(),t},R=function(e){return 0===e.length?v.none():v.some(e[0])},P=function(e){return 0===e.length?v.none():v.some(e[e.length-1])},M=function(){return(M=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},U=function(){return _(0,0)},_=function(e,t){return{major:e,minor:t}},F=function(e,t){var n=String(t).toLowerCase();return 0===e.length?U():function(e,t){var n=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.test(t))return r}}(e,t);if(!n)return{major:0,minor:0};var r=function(e){return Number(t.replace(n,"$"+e))};return _(r(1),r(2))}(e,n)},$=U,j="Edge",q="Chrome",H="Opera",K="Firefox",V="Safari",W=function(e){var t=e.current,n=e.version,r=function(e){return function(){return t===e}};return{current:t,version:n,isEdge:r(j),isChrome:r(q),isIE:r("IE"),isOpera:r(H),isFirefox:r(K),isSafari:r(V)}},Q=function(){return W({current:void 0,version:$()})},X=W,z=(c(j),c(q),c("IE"),c(H),c(K),c(V),"Windows"),Y="Android",G="Solaris",J="FreeBSD",Z="ChromeOS",ee=function(e){var t=e.current,n=e.version,r=function(e){return function(){return t===e}};return{current:t,version:n,isWindows:r(z),isiOS:r("iOS"),isAndroid:r(Y),isOSX:r("OSX"),isLinux:r("Linux"),isSolaris:r(G),isFreeBSD:r(J),isChromeOS:r(Z)}},te=function(){return ee({current:void 0,version:$()})},ne=ee,re=(c(z),c("iOS"),c(Y),c("Linux"),c("OSX"),c(G),c(J),c(Z),function(e,t){var n=String(t).toLowerCase();return E(e,function(e){return e.search(n)})}),oe=function(e,t){return-1!==e.indexOf(t)},ie=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,ae=function(e){return function(t){return oe(t,e)}},ue=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return oe(e,"edge/")&&oe(e,"chrome")&&oe(e,"safari")&&oe(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,ie],search:function(e){return oe(e,"chrome")&&!oe(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return oe(e,"msie")||oe(e,"trident")}},{name:"Opera",versionRegexes:[ie,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:ae("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:ae("firefox")},{name:"Safari",versionRegexes:[ie,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(oe(e,"safari")||oe(e,"mobile/"))&&oe(e,"applewebkit")}}],se=[{name:"Windows",search:ae("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return oe(e,"iphone")||oe(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:ae("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:ae("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:ae("linux"),versionRegexes:[]},{name:"Solaris",search:ae("sunos"),versionRegexes:[]},{name:"FreeBSD",search:ae("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:ae("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],ce={browsers:c(ue),oses:c(se)},fe=function(e,t){var n,r,o,i,a,u,s,f,d,l,m,p,g=ce.browsers(),v=ce.oses(),h=function(e,t){return re(e,t).map(function(e){var n=F(e.versionRegexes,t);return{current:e.name,version:n}})}(g,e).fold(Q,X),y=function(e,t){return re(e,t).map(function(e){var n=F(e.versionRegexes,t);return{current:e.name,version:n}})}(v,e).fold(te,ne);return{browser:h,os:y,deviceType:(r=h,o=e,i=t,a=(n=y).isiOS()&&!0===/ipad/i.test(o),u=n.isiOS()&&!a,s=n.isiOS()||n.isAndroid(),f=s||i("(pointer:coarse)"),d=a||!u&&s&&i("(min-device-width:768px)"),l=u||s&&!d,m=r.isSafari()&&n.isiOS()&&!1===/safari/i.test(o),p=!l&&!d&&!m,{isiPad:c(a),isiPhone:c(u),isTablet:c(d),isPhone:c(l),isTouch:c(f),isAndroid:n.isAndroid,isiOS:n.isiOS,isWebView:c(m),isDesktop:c(p)})}},de=function(t){return e.window.matchMedia(t).matches},le=(a=!(o=function(){return fe(e.navigator.userAgent,de)}),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a||(a=!0,i=o.apply(null,e)),i}),me=function(e){if(null==e)throw new Error("Node cannot be null or undefined");return{dom:c(e)}},pe=function(t,n){var r=(n||e.document).createElement(t);return me(r)},ge=me,ve=function(e,t){return e.dom()===t.dom()},he=function(t,n){return le().browser.isIE()?function(t,n){return r=t.dom(),o=n.dom(),i=e.Node.DOCUMENT_POSITION_CONTAINED_BY,0!=(r.compareDocumentPosition(o)&i);var r,o,i}(t,n):(r=n,(o=t.dom())!==(i=r.dom())&&o.contains(i));var r,o,i},ye=function(e,t){var n=e.dom();if(1!==n.nodeType)return!1;var r=n;if(void 0!==r.matches)return r.matches(t);if(void 0!==r.msMatchesSelector)return r.msMatchesSelector(t);if(void 0!==r.webkitMatchesSelector)return r.webkitMatchesSelector(t);if(void 0!==r.mozMatchesSelector)return r.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")},Se=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),be=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),Ce=tinymce.util.Tools.resolve("tinymce.util.VK"),Oe=function(e,t,n){return e.isSome()&&t.isSome()?v.some(n(e.getOrDie(),t.getOrDie())):v.none()},Ne=function(e){return v.from(e.dom().parentNode).map(ge)},Le=function(e){return k(e.dom().childNodes,ge)},Te=function(e,t){var n=e.dom().childNodes;return v.from(n[t]).map(ge)},ke=function(e){return Te(e,0)},xe=function(e){return Te(e,e.dom().childNodes.length-1)},Ae=function(e,t){Ne(e).each(function(n){n.dom().insertBefore(t.dom(),e.dom())})},we=function(e,t){e.dom().appendChild(t.dom())},De=function(e,t){x(t,function(t){we(e,t)})},Ee=function(e){var t=e.dom();null!==t.parentNode&&t.parentNode.removeChild(t)},Be=function(e,t,n){return e.fire("ListMutation",{action:t,element:n})},Ie=(void 0!==e.window?e.window:Function("return this;")(),tinymce.util.Tools.resolve("tinymce.dom.DomQuery")),Re=tinymce.util.Tools.resolve("tinymce.util.Tools"),Pe=function(e){return function(t){return t&&t.nodeName.toLowerCase()===e}},Me=function(e){return function(t){return t&&e.test(t.nodeName)}},Ue=function(e){return e&&3===e.nodeType},_e=Me(/^(OL|UL|DL)$/),Fe=Me(/^(OL|UL)$/),$e=Pe("ol"),je=Me(/^(LI|DT|DD)$/),qe=Me(/^(DT|DD)$/),He=Me(/^(TH|TD)$/),Ke=Pe("br"),Ve=function(e,t){return t&&!!e.schema.getTextBlockElements()[t.nodeName]},We=function(e,t){return e&&e.nodeName in t},Qe=function(e,t,n){var r=e.isEmpty(t);return!(n&&0<e.select("span[data-mce-type=bookmark]",t).length)&&r},Xe=function(e,t){return e.isChildOf(t,e.getRoot())},ze=function(e,t){var n=t||e.selection.getStart(!0);return e.dom.getParent(n,"OL,UL,DL",Ge(e,n))},Ye=function(e){var t,n,r,o=e.selection.getSelectedBlocks();return Re.grep((t=e,n=o,r=Re.map(n,function(e){return t.dom.getParent(e,"li,dd,dt",Ge(t,e))||e}),Ie.unique(r)),function(e){return je(e)})},Ge=function(e,t){var n=e.dom.getParents(t,"TD,TH");return 0<n.length?n[0]:e.getBody()},Je=function(e,t){var n=e.dom.getParents(t,"ol,ul",Ge(e,t));return P(n)},Ze=function(e,t){var n=k(t,function(t){return Je(e,t).getOr(t)});return Ie.unique(n)},et=function(e,t){var n,r,o,i,a=e.dom,u=e.schema.getBlockElements(),s=a.createFragment(),c=!1===(n=e.getParam("forced_root_block","p"))?"":!0===n?"p":n;if(c&&((o=a.create(c)).tagName===c.toUpperCase()&&a.setAttribs(o,e.getParam("forced_root_block_attrs",{})),We(t.firstChild,u)||s.appendChild(o)),t)for(;r=t.firstChild;){var f=r.nodeName;i||"SPAN"===f&&"bookmark"===r.getAttribute("data-mce-type")||(i=!0),We(r,u)?(s.appendChild(r),o=null):c?(o||(o=a.create(c),s.appendChild(o)),o.appendChild(r)):s.appendChild(r)}return c?i||o.appendChild(a.create("br",{"data-mce-bogus":"1"})):s.appendChild(a.create("br")),s},tt=Object.keys,nt=function(e,t){for(var n=tt(e),r=0,o=n.length;r<o;r++){var i=n[r];t(e[i],i)}},rt=function(e){return e.dom().nodeName.toLowerCase()},ot=(1,function(e){return 1===e.dom().nodeType}),it=function(t,n){var r=t.dom();nt(n,function(t,n){!function(t,n,r){if(!(S(r)||C(r)||N(r)))throw e.console.error("Invalid call to Attr.set. Key ",n,":: Value ",r,":: Element ",t),new Error("Attribute value was not simple");t.setAttribute(n,r+"")}(r,n,t)})},at=function(e){return w(e.dom().attributes,function(e,t){return e[t.name]=t.value,e},{})},ut=function(t,n,r){if(!S(r))throw e.console.error("Invalid call to CSS.set. Property ",n,":: Value ",r,":: Element ",t),new Error("CSS value must be a string: "+r);var o;void 0!==(o=t).style&&O(o.style.getPropertyValue)&&t.style.setProperty(n,r)},st=function(e){return!0,ge(e.dom().cloneNode(!0))},ct=function(e,t){var n,r,o,i=(n=e,r=pe(t),o=at(n),it(r,o),r);Ae(e,i);var a=Le(e);return De(i,a),Ee(e),i},ft=function(e,t){we(e.item,t.list)},dt=function(e){return ye(e,"OL,UL")},lt=function(e){return ke(e).map(dt).getOr(!1)},mt=function(e){return 0<e.depth},pt=function(e){return e.isSelected},gt=function(e){var t=Le(e),n=xe(e).map(dt).getOr(!1)?t.slice(0,-1):t;return k(n,st)},vt=function(e){return x(e,function(t,n){var r,o,i,a,u;i=(r=e)[o=n].depth,a=function(e){return e.depth===i&&!e.dirty},u=function(e){return e.depth<i},D(I(r.slice(0,o)),a,u).orThunk(function(){return D(r.slice(o+1),a,u)}).fold(function(){var e;t.dirty&&((e=t).listAttributes=function(e,t){var n,r,o,i,a={};return n=t,i=a,r=function(e,t){i[t]=e},o=s,nt(e,function(e,t){(n(e,t)?r:o)(e,t)}),a}(e.listAttributes,function(e,t){return"start"!==t}))},function(e){return r=e,(n=t).listType=r.listType,void(n.listAttributes=M({},r.listAttributes));var n,r})}),e},ht=function(e,t,n,r){return B(Le(r),function(r){return(dt(r)?ht:function(e,t,n,r){return ke(r).filter(dt).fold(function(){t.each(function(e){ve(e.start,r)&&n.set(!0)});var o,i,a,u=(o=r,i=e,a=n.get(),Ne(o).filter(ot).map(function(e){return{depth:i,dirty:!1,isSelected:a,content:gt(o),itemAttributes:at(o),listAttributes:at(e),listType:rt(e)}}));t.each(function(e){ve(e.end,r)&&n.set(!1)});var s=xe(r).filter(dt).map(function(r){return ht(e,t,n,r)}).getOr([]);return u.toArray().concat(s)},function(r){return ht(e,t,n,r)})})(e+1,t,n,r)})},yt=function(t,n){var r=vt(n);return k(r,function(n){var r,o,i=(r=n.content,o=e.document.createDocumentFragment(),x(r,function(e){o.appendChild(e.dom())}),ge(o));return ge(et(t,i.dom()))})},St=function(e,t){var n,r,o=vt(t);return n=e.contentDocument,r=w(o,function(e,t){return(t.depth>e.length?function(e,t,n){var r,o=function(e,t,n){for(var r,o,i,a=[],u=0;u<n;u++)a.push((r=e,o=t.listType,i={list:pe(o,r),item:pe("li",r)},we(i.list,i.item),i));return a}(e,n,n.depth-t.length);return function(e){for(var t=1;t<e.length;t++)ft(e[t-1],e[t])}(o),function(e,t){for(var n=0;n<e.length-1;n++)r=e[n].item.dom(),ut(r,"list-style-type","none");var r;P(e).each(function(e){it(e.list,t.listAttributes),it(e.item,t.itemAttributes),De(e.item,t.content)})}(o,n),r=o,Oe(P(t),R(r),ft),t.concat(o)}:function(e,t,n){var r=t.slice(0,n.depth);return P(r).each(function(t){var r,o,i,a,u,s,c,f;r=e,o=n.itemAttributes,i=n.content,a=pe("li",r),it(a,o),De(a,i),s=a,we((u=t).list,s),u.item=s,f=n,rt((c=t).list)!==f.listType&&(c.list=ct(c.list,f.listType)),it(c.list,f.listAttributes)}),r})(n,e,t)},[]),R(r).map(function(e){return e.list}).toArray()},bt=function(e,t,n){var r,o=function(e,t){var n,r=(n=!1,{get:function(){return n},set:function(e){n=e}});return k(e,function(e){return{sourceList:e,entries:ht(0,t,r,e)}})}(t,(r=k(Ye(e),ge),Oe(E(r,f(lt)),E(I(r),f(lt)),function(e,t){return{start:e,end:t}})));x(o,function(t){var r,o;r=t.entries,o=n,x(A(r,pt),function(e){return function(e,t){switch(o){case"Indent":t.depth++;break;case"Outdent":t.depth--;break;case"Flatten":t.depth=0}t.dirty=!0}(0,e)});var i,a,u,s=(i=e,a=t.entries,B(function(e,t){if(0===e.length)return[];for(var n=t(e[0]),r=[],o=[],i=0,a=e.length;i<a;i++){var u=e[i],s=t(u);s!==n&&(r.push(o),o=[]),n=s,o.push(u)}return 0!==o.length&&r.push(o),r}(a,mt),function(e){return(R(e).map(mt).getOr(!1)?St:yt)(i,e)}));x(s,function(t){Be(e,"Indent"===n?"IndentList":"OutdentList",t.dom())}),u=t.sourceList,x(s,function(e){Ae(u,e)}),Ee(t.sourceList)})},Ct=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),Ot=Ct.DOM,Nt=function(e){ye(e,"dt")&&ct(e,"dd")},Lt=function(e,t){if(Ue(e))return{container:e,offset:t};var n=Se.getNode(e,t);return Ue(n)?{container:n,offset:t>=e.childNodes.length?n.data.length:0}:n.previousSibling&&Ue(n.previousSibling)?{container:n.previousSibling,offset:n.previousSibling.data.length}:n.nextSibling&&Ue(n.nextSibling)?{container:n.nextSibling,offset:0}:{container:e,offset:t}},Tt=function(e){var t=e.cloneRange(),n=Lt(e.startContainer,e.startOffset);t.setStart(n.container,n.offset);var r=Lt(e.endContainer,e.endOffset);return t.setEnd(r.container,r.offset),t},kt=function(e,t){var n,r=k(function(e){var t,n,r,o=(n=Je(t=e,t.selection.getStart()),r=A(t.selection.getSelectedBlocks(),Fe),n.toArray().concat(r));return Ze(e,o)}(e),ge),o=k(A(Ye(e),qe),ge),i=!1;if(r.length||o.length){var a=e.selection.getBookmark();bt(e,r,t),n=e,x(o,"Indent"===t?Nt:function(e){return function(e,t){ye(t,"dd")?ct(t,"dt"):ye(t,"dt")&&Ne(t).each(function(n){return function(e,t,n){var r,o,i,a,u,s;for(i=Ot.select('span[data-mce-type="bookmark"]',t),u=et(e,n),(r=Ot.createRng()).setStartAfter(n),r.setEndAfter(t),a=(o=r.extractContents()).firstChild;a;a=a.firstChild)if("LI"===a.nodeName&&e.dom.isEmpty(a)){Ot.remove(a);break}e.dom.isEmpty(o)||Ot.insertAfter(o,t),Ot.insertAfter(u,t),Qe(e.dom,n.parentNode)&&(s=n.parentNode,Re.each(i,function(e){s.parentNode.insertBefore(e,n.parentNode)}),Ot.remove(s)),Ot.remove(n),Qe(e.dom,t)&&Ot.remove(t)}(e,n.dom(),t.dom())})}(n,e)}),e.selection.moveToBookmark(a),e.selection.setRng(Tt(e.selection.getRng())),e.nodeChanged(),i=!0}return i},xt=function(e){return kt(e,"Indent")},At=function(e){return kt(e,"Outdent")},wt=function(e){return kt(e,"Flatten")},Dt=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager"),Et=Ct.DOM,Bt=function(e){var t={},n=function(n){var r,o,i;o=e[n?"startContainer":"endContainer"],i=e[n?"startOffset":"endOffset"],1===o.nodeType&&(r=Et.create("span",{"data-mce-type":"bookmark"}),o.hasChildNodes()?(i=Math.min(i,o.childNodes.length-1),n?o.insertBefore(r,o.childNodes[i]):Et.insertAfter(r,o.childNodes[i])):o.appendChild(r),o=r,i=0),t[n?"startContainer":"endContainer"]=o,t[n?"startOffset":"endOffset"]=i};return n(!0),e.collapsed||n(),t},It=function(e){function t(t){var n,r,o;n=o=e[t?"startContainer":"endContainer"],r=e[t?"startOffset":"endOffset"],n&&(1===n.nodeType&&(r=function(e){for(var t=e.parentNode.firstChild,n=0;t;){if(t===e)return n;1===t.nodeType&&"bookmark"===t.getAttribute("data-mce-type")||n++,t=t.nextSibling}return-1}(n),n=n.parentNode,Et.remove(o),!n.hasChildNodes()&&Et.isBlock(n)&&n.appendChild(Et.create("br"))),e[t?"startContainer":"endContainer"]=n,e[t?"startOffset":"endOffset"]=r)}t(!0),t();var n=Et.createRng();return n.setStart(e.startContainer,e.startOffset),e.endContainer&&n.setEnd(e.endContainer,e.endOffset),Tt(n)},Rt=function(e){return/\btox\-/.test(e.className)},Pt=function(e,t,n){return function(){var r=function(e){var r=D(e.parents,_e,He).filter(function(e){return e.nodeName===t&&!Rt(e)}).isSome();n(r)};return e.on("NodeChange",r),function(){return e.off("NodeChange",r)}}},Mt=function(e){switch(e){case"UL":return"ToggleUlList";case"OL":return"ToggleOlList";case"DL":return"ToggleDLList"}},Ut=function(e,t){Re.each(t,function(t,n){e.setAttribute(n,t)})},_t=function(e,t,n){var r,o,i,a,u,s,c;r=e,o=t,a=(i=n)["list-style-type"]?i["list-style-type"]:null,r.setStyle(o,"list-style-type",a),u=e,Ut(s=t,(c=n)["list-attributes"]),Re.each(u.select("li",s),function(e){Ut(e,c["list-item-attributes"])})},Ft=function(e,t,n,r){var o,i;for(o=t[n?"startContainer":"endContainer"],i=t[n?"startOffset":"endOffset"],1===o.nodeType&&(o=o.childNodes[Math.min(i,o.childNodes.length-1)]||o),!n&&Ke(o.nextSibling)&&(o=o.nextSibling);o.parentNode!==r;){if(Ve(e,o))return o;if(/^(TD|TH)$/.test(o.parentNode.nodeName))return o;o=o.parentNode}return o},$t=function(e,t,n){return s=n,(u=t)&&s&&_e(u)&&u.nodeName===s.nodeName&&(i=t,a=n,(o=e).getStyle(i,"list-style-type",!0)===o.getStyle(a,"list-style-type",!0))&&(r=n,t.className===r.className);var r,o,i,a,u,s},jt=function(e,t){var n,r;if(n=t.nextSibling,$t(e,t,n)){for(;r=n.firstChild;)t.appendChild(r);e.remove(n)}if(n=t.previousSibling,$t(e,t,n)){for(;r=n.lastChild;)t.insertBefore(r,t.firstChild);e.remove(n)}},qt=function(e){return"list-style-type"in e},Ht=function(e,t,n){var r=ze(e),o=function(e){var t,n,r,o=ze(e),i=e.selection.getSelectedBlocks();return r=i,(n=o)&&1===r.length&&r[0]===n?(t=o,Re.grep(t.querySelectorAll("ol,ul,dl"),function(e){return _e(e)})):Re.grep(i,function(e){return _e(e)&&o!==e})}(e);n=n||{},r&&0<o.length?function(e,t,n,r,o){if(t.nodeName!==r||qt(o)){var i=Bt(e.selection.getRng(!0));Re.each([t].concat(n),function(t){!function(e,t,n,r){if(t.nodeName!==n){var o=e.dom.rename(t,n);_t(e.dom,o,r),Be(e,Mt(n),o)}else _t(e.dom,t,r),Be(e,Mt(n),t)}(e,t,r,o)}),e.selection.setRng(It(i))}else wt(e)}(e,r,o,t,n):function(e,t,n,r){if(t!==e.getBody())if(t)if(t.nodeName!==n||qt(r)||Rt(t)){var o=Bt(e.selection.getRng(!0));_t(e.dom,t,r);var i=e.dom.rename(t,n);jt(e.dom,i),e.selection.setRng(It(o)),Be(e,Mt(n),i)}else wt(e);else(function(e,t,n){void 0===n&&(n={});var r,o=e.selection.getRng(!0),i="LI",a=Ge(e,e.selection.getStart(!0)),u=e.dom;"false"!==u.getContentEditable(e.selection.getNode())&&("DL"===(t=t.toUpperCase())&&(i="DT"),r=Bt(o),Re.each(function(e,t,n){for(var r,o=[],i=e.dom,a=Ft(e,t,!0,n),u=Ft(e,t,!1,n),s=[],c=a;c&&(s.push(c),c!==u);c=c.nextSibling);return Re.each(s,function(t){if(Ve(e,t))return o.push(t),void(r=null);if(i.isBlock(t)||Ke(t))return Ke(t)&&i.remove(t),void(r=null);var a=t.nextSibling;Dt.isBookmarkNode(t)&&(Ve(e,a)||!a&&t.parentNode===n)?r=null:(r||(r=i.create("p"),t.parentNode.insertBefore(r,t),o.push(r)),r.appendChild(t))}),o}(e,o,a),function(r){var o,a,s,c,f,d,l,m;(a=r.previousSibling)&&_e(a)&&a.nodeName===t&&(s=a,c=n,u.getStyle(s,"list-style-type")===(f=null===(f=c?c["list-style-type"]:"")?"":f))?(o=a,r=u.rename(r,i),a.appendChild(r)):(o=u.create(t),r.parentNode.insertBefore(o,r),o.appendChild(r),r=u.rename(r,i)),d=u,l=r,m=["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"],Re.each(m,function(e){var t;return d.setStyle(l,((t={})[e]="",t))}),_t(u,o,n),jt(e.dom,o)}),e.selection.setRng(It(r)))})(e,n,r),Be(e,Mt(n),t)}(e,r,t,n)},Kt=Ct.DOM,Vt=function(e,t,n,r){var o=t.startContainer,i=t.startOffset;if(Ue(o)&&(n?i<o.data.length:0<i))return o;var a=e.schema.getNonEmptyElements();1===o.nodeType&&(o=Se.getNode(o,i));var u,s,c=new be(o,r);for(n&&(u=e.dom,Ke(s=o)&&u.isBlock(s.nextSibling)&&!Ke(s.previousSibling)&&c.next());o=c[n?"next":"prev2"]();){if("LI"===o.nodeName&&!o.hasChildNodes())return o;if(a[o.nodeName])return o;if(Ue(o)&&0<o.data.length)return o}},Wt=function(e,t){var n=t.childNodes;return 1===n.length&&!_e(n[0])&&e.isBlock(n[0])},Qt=function(e,t,n){var r,o,i=t.parentNode;if(Xe(e,t)&&Xe(e,n)){_e(n.lastChild)&&(o=n.lastChild),i===n.lastChild&&Ke(i.previousSibling)&&e.remove(i.previousSibling),(r=n.lastChild)&&Ke(r)&&t.hasChildNodes()&&e.remove(r),Qe(e,n,!0)&&e.$(n).empty(),function(e,t,n){var r,o,i,a;if(o=Wt(e,n)?n.firstChild:n,Wt(i=e,a=t)&&i.remove(a.firstChild,!0),!Qe(e,t,!0))for(;r=t.firstChild;)o.appendChild(r)}(e,t,n),o&&n.appendChild(o);var a=he(ge(n),ge(t))?e.getParents(t,_e,n):[];e.remove(t),x(a,function(t){Qe(e,t)&&t!==e.getRoot()&&e.remove(t)})}},Xt=function(e,t){var n=e.dom,r=e.selection,o=r.getStart(),i=Ge(e,o),a=n.getParent(r.getStart(),"LI",i);if(a){var u=a.parentNode;if(u===e.getBody()&&Qe(n,u))return!0;var s=Tt(r.getRng()),c=n.getParent(Vt(e,s,t,i),"LI",i);if(c&&c!==a)return e.undoManager.transact(function(){var n;t?function(e,t,n,r){var o,i,a,u=e.dom;if(u.isEmpty(r))i=n,a=r,(o=e).dom.$(a).empty(),Qt(o.dom,i,a),o.selection.setCursorLocation(a);else{var s=Bt(t);Qt(u,n,r),e.selection.setRng(It(s))}}(e,s,c,a):(n=a).parentNode.firstChild===n?At(e):function(e,t,n,r){var o=Bt(s);Qt(e.dom,n,r);var i=It(o);e.selection.setRng(i)}(e,0,a,c)}),!0;if(!c&&!t&&0===s.startOffset&&0===s.endOffset)return e.undoManager.transact(function(){wt(e)}),!0}return!1},zt=function(e,t){return e.selection.isCollapsed()?Xt(i=e,a=t)||function(e,t){var n=e.dom,r=e.selection.getStart(),o=Ge(e,r),i=n.getParent(r,n.isBlock,o);if(i&&n.isEmpty(i)){var a=Tt(e.selection.getRng()),u=n.getParent(Vt(e,a,t,o),"LI",o);if(u)return e.undoManager.transact(function(){var r,a,s,c;a=i,s=o,c=(r=n).getParent(a.parentNode,r.isBlock,s),r.remove(a),c&&r.isEmpty(c)&&r.remove(c),jt(n,u.parentNode),e.selection.select(u,!0),e.selection.collapse(t)}),!0}return!1}(i,a):(r=(n=e).selection.getStart(),o=Ge(n,r),!!(n.dom.getParent(r,"LI,DT,DD",o)||0<Ye(n).length)&&(n.undoManager.transact(function(){var e,t;n.execCommand("Delete"),e=n.dom,t=n.getBody(),Re.each(Re.grep(e.select("ol,ul",t)),function(t){var n,r,o,i;n=e,"LI"===(i=(r=t).parentNode).nodeName&&i.firstChild===r&&((o=i.previousSibling)&&"LI"===o.nodeName?(o.appendChild(r),Qe(n,i)&&Kt.remove(i)):Kt.setStyle(i,"listStyleType","none")),_e(i)&&(o=i.previousSibling)&&"LI"===o.nodeName&&o.appendChild(r)})}),!0));var n,r,o,i,a},Yt=function(e){var t=e.dom,n=ze(e);$e(n)&&e.windowManager.open({title:"List Properties",body:{type:"panel",items:[{type:"input",name:"start",label:"Start list at number",inputMode:"numeric"}]},initialData:{start:t.getAttrib(n,"start")||"1"},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:function(n){var r=n.getData();e.undoManager.transact(function(){t.setAttrib(ze(e),"start","1"===r.start?"":r.start)}),n.close()}})},Gt=function(e,t){return function(){var n=e.dom.getParent(e.selection.getStart(),"UL,OL,DL");return n&&n.nodeName===t}};u.add("lists",function(e){var t,n,r,o,i,a,s,c;return 0==!(!/(^|[ ,])rtc([, ]|$)/.test(e.settings.plugins)||!u.get("rtc"))&&(function(e){var t,n;e.getParam("lists_indent_on_tab",!0)&&(t=e).on("keydown",function(e){e.keyCode!==Ce.TAB||Ce.metaKeyPressed(e)||t.undoManager.transact(function(){(e.shiftKey?At:xt)(t)&&e.preventDefault()})}),(n=e).on("keydown",function(e){e.keyCode===Ce.BACKSPACE?zt(n,!1)&&e.preventDefault():e.keyCode===Ce.DELETE&&zt(n,!0)&&e.preventDefault()})}(e),(t=e).on("BeforeExecCommand",function(e){var n=e.command.toLowerCase();"indent"===n?xt(t):"outdent"===n&&At(t)}),t.addCommand("InsertUnorderedList",function(e,n){Ht(t,"UL",n)}),t.addCommand("InsertOrderedList",function(e,n){Ht(t,"OL",n)}),t.addCommand("InsertDefinitionList",function(e,n){Ht(t,"DL",n)}),t.addCommand("RemoveList",function(){wt(t)}),t.addCommand("mceListProps",function(){Yt(t)}),t.addQueryStateHandler("InsertUnorderedList",Gt(t,"UL")),t.addQueryStateHandler("InsertOrderedList",Gt(t,"OL")),t.addQueryStateHandler("InsertDefinitionList",Gt(t,"DL"))),i=function(e){return function(){return n.execCommand(e)}},o=(r=n=e).settings.plugins?r.settings.plugins:"",-1===Re.inArray(o.split(/[ ,]/),"advlist")&&(n.ui.registry.addToggleButton("numlist",{icon:"ordered-list",active:!1,tooltip:"Numbered list",onAction:i("InsertOrderedList"),onSetup:function(e){return Pt(n,"OL",e.setActive)}}),n.ui.registry.addToggleButton("bullist",{icon:"unordered-list",active:!1,tooltip:"Bullet list",onAction:i("InsertUnorderedList"),onSetup:function(e){return Pt(n,"UL",e.setActive)}})),s={text:"List properties...",icon:"ordered-list",onAction:function(){return Yt(a)},onSetup:function(e){return Pt(a,"OL",function(t){return e.setDisabled(!t)})}},(a=e).ui.registry.addMenuItem("listprops",s),a.ui.registry.addContextMenu("lists",{update:function(e){var t=ze(a,e);return $e(t)?["listprops"]:[]}}),c=e,{backspaceDelete:function(e){zt(c,e)}}})}(window);