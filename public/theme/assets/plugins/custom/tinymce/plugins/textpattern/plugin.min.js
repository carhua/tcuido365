!function(t){"use strict";var n,r,e,o=tinymce.util.Tools.resolve("tinymce.PluginManager"),a=function(){return(a=Object.assign||function(t){for(var n,r=1,e=arguments.length;r<e;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},i=function(){},u=function(t){return function(){return t}},f=function(t){return t},c=u(!1),s=u(!0),l=function(){return d},d=(n=function(t){return t.isNone()},{fold:function(t,n){return t()},is:c,isSome:c,isNone:s,getOr:e=function(t){return t},getOrThunk:r=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:u(null),getOrUndefined:u(void 0),or:e,orThunk:r,map:l,each:i,bind:l,exists:c,forall:s,filter:l,equals:n,equals_:n,toArray:function(){return[]},toString:u("none()")}),m=function(t){var n=u(t),r=function(){return o},e=function(n){return n(t)},o={fold:function(n,r){return r(t)},is:function(n){return t===n},isSome:s,isNone:c,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:r,orThunk:r,map:function(n){return m(n(t))},each:function(n){n(t)},bind:e,exists:e,forall:e,filter:function(n){return n(t)?o:d},toArray:function(){return[t]},toString:function(){return"some("+t+")"},equals:function(n){return n.is(t)},equals_:function(n,r){return n.fold(c,function(n){return r(t,n)})}};return o},g={some:m,none:l,from:function(t){return null==t?d:m(t)}},p=function(t){return function(n){return e=typeof(r=n),(null===r?"null":"object"==e&&(Array.prototype.isPrototypeOf(r)||r.constructor&&"Array"===r.constructor.name)?"array":"object"==e&&(String.prototype.isPrototypeOf(r)||r.constructor&&"String"===r.constructor.name)?"string":e)===t;var r,e}},h=p("string"),v=p("object"),y=p("array"),b=Array.prototype.slice,k=Array.prototype.indexOf,O=function(t,n){return r=t,e=n,-1<k.call(r,e);var r,e},w=function(t,n){for(var r=t.length,e=new Array(r),o=0;o<r;o++){var a=t[o];e[o]=n(a,o)}return e},C=function(t,n){for(var r=0,e=t.length;r<e;r++)n(t[r],r)},x=function(t,n){for(var r=[],e=0,o=t.length;e<o;e++){var a=t[e];n(a,e)&&r.push(a)}return r},E=function(t,n,r){return function(t,n){for(var r=t.length-1;0<=r;r--)n(t[r])}(t,function(t){r=n(r,t)}),r},R=function(t,n){for(var r=0,e=t.length;r<e;++r)if(!0!==n(t[r],r))return!1;return!0},T=Object.keys,N=Object.hasOwnProperty,P=function(t,n){return N.call(t,n)},S=(function(n){if(!y(n))throw new Error("cases must be an array");if(0===n.length)throw new Error("there must be at least one case");var r=[],e={};C(n,function(o,a){var i=T(o);if(1!==i.length)throw new Error("one and only one name per case");var u=i[0],f=o[u];if(void 0!==e[u])throw new Error("duplicate key detected:"+u);if("cata"===u)throw new Error("cannot have a case named cata (sorry)");if(!y(f))throw new Error("case arguments must be an array");r.push(u),e[u]=function(){var e=arguments.length;if(e!==f.length)throw new Error("Wrong number of arguments to case "+u+". Expected "+f.length+" ("+f+"), got "+e);for(var o=new Array(e),i=0;i<o.length;i++)o[i]=arguments[i];return{fold:function(){if(arguments.length!==n.length)throw new Error("Wrong number of arguments to fold. Expected "+n.length+", got "+arguments.length);return arguments[a].apply(null,o)},match:function(t){var n=T(t);if(r.length!==n.length)throw new Error("Wrong number of arguments to match. Expected: "+r.join(",")+"\nActual: "+n.join(","));if(!R(r,function(t){return O(n,t)}))throw new Error("Not all branches were specified when using match. Specified: "+n.join(", ")+"\nRequired: "+r.join(", "));return t[u].apply(null,o)},log:function(n){t.console.log(n,{constructors:r,constructor:u,params:o})}}}})}([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(t){var n=[],r=[];return C(t,function(t){t.fold(function(t){n.push(t)},function(t){r.push(t)})}),{errors:n,values:r}}),M=function(t){return{is:function(n){return t===n},isValue:s,isError:c,getOr:u(t),getOrThunk:u(t),getOrDie:u(t),or:function(n){return M(t)},orThunk:function(n){return M(t)},fold:function(n,r){return r(t)},map:function(n){return M(n(t))},mapError:function(n){return M(t)},each:function(n){n(t)},bind:function(n){return n(t)},exists:function(n){return n(t)},forall:function(n){return n(t)},toOption:function(){return g.some(t)}}},A=function(t){return{is:c,isValue:c,isError:s,getOr:f,getOrThunk:function(t){return t()},getOrDie:function(){return n=String(t),function(){throw new Error(n)}();var n},or:function(t){return t},orThunk:function(t){return t()},fold:function(n,r){return n(t)},map:function(n){return A(t)},mapError:function(n){return A(n(t))},each:i,bind:function(n){return A(t)},exists:c,forall:s,toOption:g.none}},B={value:M,error:A,fromOption:function(t,n){return t.fold(function(){return A(n)},M)}},D=function(t){return"inline-command"===t.type||"inline-format"===t.type},I=function(t){return"block-command"===t.type||"block-format"===t.type},j=function(t){return n=t,r=function(t,n){return t.start.length===n.start.length?0:t.start.length>n.start.length?-1:1},(e=b.call(n,0)).sort(r),e;var n,r,e},_=function(t){var n=function(n){return B.error({message:n,pattern:t})},r=function(r,e,o){if(void 0===t.format)return void 0!==t.cmd?h(t.cmd)?B.value(o(t.cmd,t.value)):n(r+" pattern has non-string `cmd` parameter"):n(r+" pattern is missing both `format` and `cmd` parameters");var a=void 0;if(y(t.format)){if(!R(t.format,h))return n(r+" pattern has non-string items in the `format` array");a=t.format}else{if(!h(t.format))return n(r+" pattern has non-string `format` parameter");a=[t.format]}return B.value(e(a))};if(!v(t))return n("Raw pattern is not an object");if(!h(t.start))return n("Raw pattern is missing `start` parameter");if(void 0===t.end)return void 0!==t.replacement?h(t.replacement)?0===t.start.length?n("Replacement pattern has empty `start` parameter"):B.value({type:"inline-command",start:"",end:t.start,cmd:"mceInsertContent",value:t.replacement}):n("Replacement pattern has non-string `replacement` parameter"):0===t.start.length?n("Block pattern has empty `start` parameter"):r("Block",function(n){return{type:"block-format",start:t.start,format:n[0]}},function(n,r){return{type:"block-command",start:t.start,cmd:n,value:r}});if(!h(t.end))return n("Inline pattern has non-string `end` parameter");if(0===t.start.length&&0===t.end.length)return n("Inline pattern has empty `start` and `end` parameters");var e=t.start,o=t.end;return 0===o.length&&(o=e,e=""),r("Inline",function(t){return{type:"inline-format",start:e,end:o,format:t}},function(t,n){return{type:"inline-command",start:e,end:o,cmd:t,value:n}})},U=function(t){return"block-command"===t.type?{start:t.start,cmd:t.cmd,value:t.value}:"block-format"===t.type?{start:t.start,format:t.format}:"inline-command"===t.type?"mceInsertContent"===t.cmd&&""===t.start?{start:t.end,replacement:t.value}:{start:t.start,end:t.end,cmd:t.cmd,value:t.value}:"inline-format"===t.type?{start:t.start,end:t.end,format:1===t.format.length?t.format[0]:t.format}:void 0},q=function(t){return{inlinePatterns:x(t,D),blockPatterns:j(x(t,I))}},L=void 0!==t.window?t.window:Function("return this;")(),V=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=L.console;r&&(r.error?r.error.apply(r,t):r.log.apply(r,t))},W=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],F=function(t){var n=t.getParam("forced_root_block","p");return!1===n?"":!0===n?"p":n},G=tinymce.util.Tools.resolve("tinymce.util.Delay"),H=tinymce.util.Tools.resolve("tinymce.util.VK"),J=tinymce.util.Tools.resolve("tinymce.util.Tools"),K=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),X=tinymce.util.Tools.resolve("tinymce.dom.TextSeeker"),z=function(t,n){return{container:t,offset:n}},Q=function(n){return n.nodeType===t.Node.TEXT_NODE},Y=function(t,n,r){if(n&&t.isEmpty(n)&&!r(n)){var e=n.parentNode;t.remove(n),Y(t,e,r)}},Z=function(t,n,r,e){void 0===e&&(e=!0);var o=n.startContainer.parentNode,a=n.endContainer.parentNode;n.deleteContents(),e&&!r(n.startContainer)&&(Q(n.startContainer)&&0===n.startContainer.data.length&&t.remove(n.startContainer),Q(n.endContainer)&&0===n.endContainer.data.length&&t.remove(n.endContainer),Y(t,o,r),o!==a&&Y(t,a,r))},$=function(t){return 0===t.start.length},tt=function(t,n){var r=g.from(t.dom.getParent(n.startContainer,t.dom.isBlock));return""===F(t)?r.orThunk(function(){return g.some(t.getBody())}):r},nt=K.DOM,rt=function(t){return function(n){return t===n?-1:0}},et=function(t,n,r){if(Q(t)&&0<=n)return g.some(z(t,n));var e=X(nt);return g.from(e.backwards(t,n,rt(t),r)).map(function(t){return z(t.container,t.container.data.length)})},ot=function(t,n,r){if(!Q(t))return g.none();var e=t.textContent;if(0<=n&&n<=e.length)return g.some(z(t,n));var o=X(nt);return g.from(o.backwards(t,n,rt(t),r)).bind(function(t){var e=t.container.data;return ot(t.container,n+e.length,r)})},at=function(t,n,r){if(!Q(t))return g.none();var e=t.textContent;if(n<=e.length)return g.some(z(t,n));var o=X(nt);return g.from(o.forwards(t,n,rt(t),r)).bind(function(t){return at(t.container,n-e.length,r)})},it=function(t,n,r){if(Q(n)&&(r<0||r>n.data.length))return[];for(var e=[r],o=n;o!==t&&o.parentNode;){for(var a=o.parentNode,i=0;i<a.childNodes.length;i++)if(a.childNodes[i]===o){e.push(i);break}o=a}return o===t?e.reverse():[]},ut=function(t,n,r,e,o){return{start:it(t,n,r),end:it(t,e,o)}},ft=function(t,n){var r,e,o,a=n.slice(),i=a.pop();return r=a,e=function(t,n){return t.bind(function(t){return g.from(t.childNodes[n])})},o=g.some(t),C(r,function(t){o=e(o,t)}),o.bind(function(t){return Q(t)&&0<=i&&t.data.length,g.some({node:t,offset:i})})},ct=function(n,r){return ft(n,r.start).bind(function(e){var o=e.node,a=e.offset;return ft(n,r.end).map(function(n){var r=n.node,e=n.offset,i=t.document.createRange();return i.setStart(o,a),i.setEnd(r,e),i})})},st=function(t,n,r){(function(t,n,r){if(Q(t)&&0>=t.length)return g.some(z(t,0));var e=X(nt);return g.from(e.forwards(t,0,rt(t),r)).map(function(t){return z(t.container,0)})})(n,0,n).each(function(e){var o=e.container;at(o,r.start.length,n).each(function(r){var e=t.createRng();e.setStart(o,0),e.setEnd(r.container,r.offset),Z(t,e,function(t){return t===n})})})},lt=function(t,n){var r=t.dom,e=t.selection.getRng();return tt(t,e).filter(function(n){var e=F(t),o=""===e&&r.is(n,"body")||r.is(n,e);return null!==n&&o}).bind(function(t){var e,o,a,i=t.textContent;return(e=n,a=(o=i).replace("Â "," "),function(t,n){return function(t,n,r){for(var e=0,o=t.length;e<o;e++){var a=t[e];if(n(a,e))return g.some(a);if(r(a,e))break}return g.none()}(t,n,c)}(e,function(t){return 0===o.indexOf(t.start)||0===a.indexOf(t.start)})).map(function(n){return J.trim(i).length===n.start.length?[]:[{pattern:n,range:ut(r.getRoot(),t,0,t,0)}]})}).getOr([])},dt=function(t,n){if(0!==n.length){var r=t.selection.getBookmark();C(n,function(n){return e=n,o=(r=t).dom,a=e.pattern,i=ct(o.getRoot(),e.range).getOrDie("Unable to resolve path range"),tt(r,i).each(function(t){"block-format"===a.type?function(t,n){var r,e=n.get(t);return y(e)&&(0===(r=e).length?g.none():g.some(r[0])).exists(function(t){return P(t,"block")})}(a.format,r.formatter)&&r.undoManager.transact(function(){st(r.dom,t,a),r.formatter.apply(a.format)}):"block-command"===a.type&&r.undoManager.transact(function(){st(r.dom,t,a),r.execCommand(a.cmd,!1,a.value)})}),1;var r,e,o,a,i}),t.selection.moveToBookmark(r)}},mt=0,gt=function(t,n){return t.create("span",{"data-mce-type":"bookmark",id:n})},pt=function(t,n){var r=t.createRng();return r.setStartAfter(n.start),r.setEndBefore(n.end),r},ht=function(t,n,r){var e=ct(t.getRoot(),r).getOrDie("Unable to resolve path range"),o=e.startContainer,a=e.endContainer,i=0===e.endOffset?a:a.splitText(e.endOffset),u=0===e.startOffset?o:o.splitText(e.startOffset);return{prefix:n,end:i.parentNode.insertBefore(gt(t,n+"-end"),i),start:u.parentNode.insertBefore(gt(t,n+"-start"),u)}},vt=function(t,n,r){Y(t,t.get(n.prefix+"-end"),r),Y(t,t.get(n.prefix+"-start"),r)},yt=function(t,n,r,e){var o,a=n.start;return function(t,n,r,e,o){var a,i=X(t,(a=t,function(t){return a.isBlock(t)||O(["BR","IMG","HR","INPUT"],t.nodeName)||"false"===a.getContentEditable(t)}));return g.from(i.backwards(n,r,e,o))}(t,e.container,e.offset,(o=a,function(t,n){var r=t.data.substring(0,n),e=r.lastIndexOf(o.charAt(o.length-1)),a=r.lastIndexOf(o);return-1!==a?a+o.length:-1!==e?e+1:-1}),r).bind(function(e){if(e.offset>=a.length){var o=t.createRng();return o.setStart(e.container,e.offset-a.length),o.setEnd(e.container,e.offset),g.some(o)}var i=e.offset-a.length;return ot(e.container,i,r).map(function(n){var r=t.createRng();return r.setStart(n.container,n.offset),r.setEnd(e.container,e.offset),r}).filter(function(t){return t.toString()===a}).orThunk(function(){return yt(t,n,r,z(e.container,0))})})},bt=function(t,n,r){var e=t.dom,o=e.getRoot(),a=r.pattern,i=r.position.container,u=r.position.offset;return ot(i,u-r.pattern.end.length,n).bind(function(f){var c=ut(o,f.container,f.offset,i,u);if($(a))return g.some({matches:[{pattern:a,startRng:c,endRng:c}],position:f});var s=kt(t,r.remainingPatterns,f.container,f.offset,n),l=s.getOr({matches:[],position:f}),d=l.position;return function(t,n,r,e,o,a){if(void 0===a&&(a=!1),0!==n.start.length||a)return et(r,e,o).bind(function(r){return yt(t,n,o,r).bind(function(t){if(a){if(t.endContainer===r.container&&t.endOffset===r.offset)return g.none();if(0===r.offset&&t.endContainer.textContent.length===t.endOffset)return g.none()}return g.some(t)})});var i=t.createRng();return i.setStart(r,e),i.setEnd(r,e),g.some(i)}(e,a,d.container,d.offset,n,s.isNone()).map(function(t){var n,r=ut(o,(n=t).startContainer,n.startOffset,n.endContainer,n.endOffset);return{matches:l.matches.concat([{pattern:a,startRng:r,endRng:c}]),position:z(t.startContainer,t.startOffset)}})})},kt=function(t,n,r,e,o){var a=t.dom;return et(r,e,a.getRoot()).bind(function(i){var u=a.createRng();u.setStart(o,0),u.setEnd(r,e);for(var f,c,s,l,d,m=u.toString(),p=0;p<n.length;p++){var h=n[p];if(f=m,s=void 0,l=c=h.end,d=(s=f).length-c.length,""===l||s.length>=l.length&&s.substr(d,d+l.length)===l){var v=n.slice();v.splice(p,1);var y=bt(t,o,{pattern:h,remainingPatterns:v,position:i});if(y.isSome())return y}}return g.none()})},Ot=function(t,n,r){t.selection.setRng(r),"inline-format"===n.type?C(n.format,function(n){t.formatter.apply(n)}):t.execCommand(n.cmd,!1,n.value)},wt=function(t,n,r){var e=t.selection.getRng();return!1===e.collapsed?[]:tt(t,e).bind(function(o){var a=e.startOffset-(r?1:0);return kt(t,n,e.startContainer,a,o)}).fold(function(){return[]},function(t){return t.matches})},Ct=function(t,n){if(0!==n.length){var r=t.dom,e=t.selection.getBookmark(),o=function(t,n){var r,e=(r=(new Date).getTime(),"mce_textpattern_"+Math.floor(1e9*Math.random())+ ++mt+String(r)),o=E(n,function(n,r){var o=ht(t,e+"_end"+n.length,r.endRng);return n.concat([a(a({},r),{endMarker:o})])},[]);return E(o,function(n,r){var i=o.length-n.length-1,u=$(r.pattern)?r.endMarker:ht(t,e+"_start"+i,r.startRng);return n.concat([a(a({},r),{startMarker:u})])},[])}(r,n);C(o,function(n){var e,o,a,i,u,f=r.getParent(n.startMarker.start,r.isBlock),c=function(t){return t===f};$(n.pattern)?(e=t,o=n.pattern,a=n.endMarker,i=c,u=pt(e.dom,a),Z(e.dom,u,i),Ot(e,o,u)):function(t,n,r,e,o){var a=t.dom,i=pt(a,e),u=pt(a,r);Z(a,u,o),Z(a,i,o);var f={prefix:r.prefix,start:r.end,end:e.start},c=pt(a,f);Ot(t,n,c)}(t,n.pattern,n.startMarker,n.endMarker,c),vt(r,n.endMarker,c),vt(r,n.startMarker,c)}),t.selection.moveToBookmark(e)}},xt=function(t,n){var r=wt(t,n.inlinePatterns,!0);0<r.length&&t.undoManager.transact(function(){Ct(t,r)})},Et=function(t,n,r){for(var e=0;e<t.length;e++)if(r(t[e],n))return!0};o.add("textpattern",function(t){var n,r,e=(n=function(t){var n,r=(P(n=t,"textpattern_patterns")?g.from(n.textpattern_patterns):g.none()).getOr(W);if(!y(r))return V("The setting textpattern_patterns should be an array"),{inlinePatterns:[],blockPatterns:[]};var e=S(w(r,_));return C(e.errors,function(t){return V(t.message,t.pattern)}),q(e.values)}(t.settings),r=n,{get:function(){return r},set:function(t){r=t}});return function(t,n){var r=[",",".",";",":","!","?"],e=[32];t.on("keydown",function(r){13!==r.keyCode||H.modifierPressed(r)||!function(t,n){if(!t.selection.isCollapsed())return!1;var r=wt(t,n.inlinePatterns,!1),e=lt(t,n.blockPatterns);return(0<e.length||0<r.length)&&(t.undoManager.add(),t.undoManager.extra(function(){t.execCommand("mceInsertNewLine")},function(){t.insertContent("\ufeff"),Ct(t,r),dt(t,e);var n=t.selection.getRng(),o=et(n.startContainer,n.startOffset,t.dom.getRoot());t.execCommand("mceInsertNewLine"),o.each(function(n){var r=n.container;"\ufeff"===r.data.charAt(n.offset-1)&&(r.deleteData(n.offset-1,1),Y(t.dom,r.parentNode,function(n){return n===t.dom.getRoot()}))})}),!0)}(t,n.get())||r.preventDefault()},!0),t.on("keyup",function(r){Et(e,r,function(t,n){return t===n.keyCode&&!1===H.modifierPressed(n)})&&xt(t,n.get())}),t.on("keypress",function(e){Et(r,e,function(t,n){return t.charCodeAt(0)===n.charCode})&&G.setEditorTimeout(t,function(){xt(t,n.get())})})}(t,e),function(t){return{setPatterns:function(n){var r=S(w(n,_));if(0<r.errors.length){var e=r.errors[0];throw new Error(e.message+":\n"+JSON.stringify(e.pattern,null,2))}t.set(q(r.values))},getPatterns:function(){return function(){for(var t=0,n=0,r=arguments.length;n<r;n++)t+=arguments[n].length;var e=Array(t),o=0;for(n=0;n<r;n++)for(var a=arguments[n],i=0,u=a.length;i<u;i++,o++)e[o]=a[i];return e}(w(t.get().inlinePatterns,U),w(t.get().blockPatterns,U))}}}(e)})}(window);