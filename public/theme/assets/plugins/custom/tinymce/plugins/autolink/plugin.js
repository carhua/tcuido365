!function(){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager"),e=tinymce.util.Tools.resolve("tinymce.Env"),n=function(t,e){if(e<0&&(e=0),3===t.nodeType){var n=t.data.length;e>n&&(e=n)}return e},i=function(t,e,i){1!==e.nodeType||e.hasChildNodes()?t.setStart(e,n(e,i)):t.setStartBefore(e)},o=function(t,e,i){1!==e.nodeType||e.hasChildNodes()?t.setEnd(e,n(e,i)):t.setEndAfter(e)},r=function(t,e,n){var r,f,a,s,d,l,c,u,g,h,m=function(t){return t.getParam("autolink_pattern",/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i)}(t),C=function(t){return t.getParam("default_link_target",!1)}(t);if("A"!==t.selection.getNode().tagName){if((r=t.selection.getRng(!0).cloneRange()).startOffset<5){if(!(u=r.endContainer.previousSibling)){if(!r.endContainer.firstChild||!r.endContainer.firstChild.nextSibling)return;u=r.endContainer.firstChild.nextSibling}if(g=u.length,i(r,u,g),o(r,u,g),r.endOffset<5)return;f=r.endOffset,s=u}else{if(3!==(s=r.endContainer).nodeType&&s.firstChild){for(;3!==s.nodeType&&s.firstChild;)s=s.firstChild;3===s.nodeType&&(i(r,s,0),o(r,s,s.nodeValue.length))}f=1===r.endOffset?2:r.endOffset-1-e}a=f;do{i(r,s,f>=2?f-2:0),o(r,s,f>=1?f-1:0),f-=1,h=r.toString()}while(" "!==h&&""!==h&&160!==h.charCodeAt(0)&&f-2>=0&&h!==n);!function(t,e){return t===e||" "===t||160===t.charCodeAt(0)}(r.toString(),n)?0===r.startOffset?(i(r,s,0),o(r,s,a)):(i(r,s,f),o(r,s,a)):(i(r,s,f),o(r,s,a),f+=1),"."===(l=r.toString()).charAt(l.length-1)&&o(r,s,a-1),c=(l=r.toString().trim()).match(m);var y=function(t){return t.getParam("link_default_protocol","http","string")}(t);c&&("www."===c[1]?c[1]=y+"://www.":/@$/.test(c[1])&&!/^mailto:/.test(c[1])&&(c[1]="mailto:"+c[1]),d=t.selection.getBookmark(),t.selection.setRng(r),t.execCommand("createlink",!1,c[1]+c[2]),!1!==C&&t.dom.setAttrib(t.selection.getNode(),"target",C),t.selection.moveToBookmark(d),t.nodeChanged())}},f=function(t){var n;t.on("keydown",function(e){if(13===e.keyCode)return function(t){r(t,-1,"")}(t)}),e.browser.isIE()?t.on("focus",function(){if(!n){n=!0;try{t.execCommand("AutoUrlDetect",!1,!0)}catch(t){}}}):(t.on("keypress",function(e){if(41===e.keyCode)return function(t){r(t,-1,"(")}(t)}),t.on("keyup",function(e){if(32===e.keyCode)return function(t){r(t,0,"")}(t)}))};t.add("autolink",function(t){f(t)})}();