!function(t){"use strict";var n,e,r,o,i=tinymce.util.Tools.resolve("tinymce.PluginManager"),u=tinymce.util.Tools.resolve("tinymce.util.VK"),a=function(t){return function(n){return r=typeof(e=n),(null===e?"null":"object"==r&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"==r&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":r)===t;var e,r}},l=function(t){return function(n){return typeof n===t}},c=a("string"),f=a("array"),s=function(t){return n===t},m=l("boolean"),g=l("function"),d=function(t){var n=t.getParam("link_assume_external_targets",!1);return m(n)&&n?1:!c(n)||"http"!==n&&"https"!==n?0:n},h=function(t){return t.getParam("default_link_target")},v=function(t){return t.getParam("target_list",!0)},p=function(t){return t.getParam("rel_list",[],"array")},y=function(t){return t.getParam("allow_unsafe_link_target",!1,"boolean")},k=function(){return(k=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},x=function(){},b=function(t){return function(){return t}},O=b(!1),w=b(!(n=null)),C=function(){return A},A=(e=function(t){return t.isNone()},{fold:function(t,n){return t()},is:O,isSome:O,isNone:w,getOr:o=function(t){return t},getOrThunk:r=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:b(null),getOrUndefined:b(void 0),or:o,orThunk:r,map:C,each:x,bind:C,exists:O,forall:w,filter:C,equals:e,equals_:e,toArray:function(){return[]},toString:b("none()")}),N=function(t){var n=b(t),e=function(){return o},r=function(n){return n(t)},o={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:w,isNone:O,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:e,orThunk:e,map:function(n){return N(n(t))},each:function(n){n(t)},bind:r,exists:r,forall:r,filter:function(n){return n(t)?o:A},toArray:function(){return[t]},toString:function(){return"some("+t+")"},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(O,function(n){return e(t,n)})}};return o},_={some:N,none:C,from:function(t){return null==t?A:N(t)}},P=Array.prototype.indexOf,S=Array.prototype.push,T=function(t){for(var n=[],e=0,r=t.length;e<r;++e){if(!f(t[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+t);S.apply(n,t[e])}return n},D=function(t,n){for(var e=0;e<t.length;e++){var r=n(t[e],e);if(r.isSome())return r}return _.none()},L=Object.keys,M=function(t,n){var e,r={};return function(t,n,e,r){(function(t,n){for(var e=L(t),r=0,o=e.length;r<o;r++){var i=e[r];n(t[i],i)}})(t,function(t,o){(n(t,o)?e:r)(t,o)})}(t,n,(e=r,function(t,n){e[n]=t}),x),r},E=tinymce.util.Tools.resolve("tinymce.util.Tools"),R=function(t){return!(!/(^|[ ,])rtc([, ]|$)/.test(t.settings.plugins)||!i.get("rtc"))},q=function(t){return/^\w+:/i.test(t)},K=function(t){return t.getAttribute("data-mce-href")||t.getAttribute("href")},I=function(t,n){var e,r,o=["noopener"],i=t?t.split(/\s+/):[],u=function(t){return t.filter(function(t){return-1===E.inArray(o,t)})},a=n?0<(e=u(e=i)).length?e.concat(o):o:u(i);return 0<a.length?(r=a,E.trim(r.sort().join(" "))):""},U=function(t,n){return n=n||t.selection.getNode(),$(n)?t.dom.select("a[href]",n)[0]:t.dom.getParent(n,"a[href]")},j=function(t,n){return(n?n.innerText||n.textContent:t.getContent({format:"text"})).replace(/\uFEFF/g,"")},B=function(t){return t&&"A"===t.nodeName&&!!K(t)},F=function(t){return 0<E.grep(t,B).length},V=function(t){return!(/</.test(t)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(t)||-1===t.indexOf("href=")))},$=function(t){return t&&"FIGURE"===t.nodeName&&/\bimage\b/i.test(t.className)},H=function(t,n,e){var r,o,i,u,a=t.selection.getNode(),l=U(t,a),c=function(t,n){var e,r,o=k({},n);if(!(0<p(t).length)&&!1===y(t)){var i=I(o.rel,"_blank"===o.target);o.rel=i||null}return _.from(o.target).isNone()&&!1===v(t)&&(o.target=h(t)),o.href=(e=o.href,"http"!==(r=d(t))&&"https"!==r||q(e)?e:r+"://"+e),o}(t,(o=["title","rel","class","target"],i=function(t,n){return r[n].each(function(e){t[n]=0<e.length?e:null}),t},u={href:(r=e).href},function(t,n){for(var e=0,r=t.length;e<r;e++)n(t[e])}(o,function(t){u=i(u,t)}),u));t.undoManager.transact(function(){var r,o,i,u,f,s,m,g;e.href===n.href&&n.attach(),l?(t.focus(),f=t,s=l,m=e.text,g=c,m.each(function(t){s.hasOwnProperty("innerText")?s.innerText=t:s.textContent=t}),f.dom.setAttribs(s,g),f.selection.select(s)):(r=t,o=a,i=e.text,u=c,$(o)?X(r,o,u):i.fold(function(){r.execCommand("mceInsertLink",!1,u)},function(t){r.insertContent(r.dom.createHTML("a",u,r.dom.encode(t)))}))})},z=function(t,n,e){var r,o,i,u,a,l,c;R(t)?t.execCommand("createlink",!1,(o=(r=e).class,i=r.href,u=r.rel,a=r.target,l=r.text,c=r.title,M({class:o.getOrNull(),href:i,rel:u.getOrNull(),target:a.getOrNull(),text:l.getOrNull(),title:c.getOrNull()},function(t,n){return!1===s(t)}))):H(t,n,e)},G=function(t){var n;R(t)?t.execCommand("unlink"):(n=t).undoManager.transact(function(){var t=n.selection.getNode();if($(t))J(n,t);else{var e=n.dom.getParent(t,"a[href]",n.getBody());e&&n.dom.remove(e,!0)}n.focus()})},J=function(t,n){var e=t.dom.select("img",n)[0];if(e){var r=t.dom.getParents(e,"a[href]",n)[0];r&&(r.parentNode.insertBefore(e,r),t.dom.remove(r))}},X=function(t,n,e){var r=t.dom.select("img",n)[0];if(r){var o=t.dom.create("a",e);r.parentNode.insertBefore(o,r),o.appendChild(r)}},Q=function(t){return c(t.value)?t.value:""},W=function(t){return void 0===t&&(t=Q),function(n){return _.from(n).map(function(n){return e=n,r=t,o=[],E.each(e,function(t){var n=c(t.text)?t.text:c(t.title)?t.title:"";if(void 0===t.menu){var e=r(t);o.push({text:n,value:e})}}),o;var e,r,o})}},Y=function(t){return W(Q)(t)},Z=W,tt=function(t,n){return function(e){return{name:t,type:"selectbox",label:n,items:e}}},nt=Q,et=function(t,n){var e,r,o=(e=t.text,r=e,{get:function(){return r},set:function(t){r=t}}),i=function(t,e){var r,i,u=(r=n,("link"===(i=e.name)?r.catalogs.link:"anchor"===i?r.catalogs.anchor:_.none()).getOr([]));return function(t,n,e,r){var o,i=r[n],u=0<t.length;return void 0!==i?(o=i,D(e,function(t){return _.some(t).filter(function(t){return t.value===o})}).map(function(n){return{url:{value:n.value,meta:{text:u?t:n.text,attach:x}},text:u?t:n.text}})):_.none()}(o.get(),e.name,u,t)};return{onChange:function(t,n){return"url"===n.name?function(t){if(o.get().length<=0){var n=void 0!==t.url.meta.text?t.url.meta.text:t.url.value,e=void 0!==t.url.meta.title?t.url.meta.title:"";return _.some({text:n,title:e})}return _.none()}(t()):function(t,n){return e=t,r=n,-1<P.call(e,r);var e,r}(["anchor","link"],n.name)?i(t(),n):("text"===n.name&&o.set(t().text),_.none())}}},rt=tinymce.util.Tools.resolve("tinymce.util.Delay"),ot=tinymce.util.Tools.resolve("tinymce.util.Promise"),it=function(t){var n=t.href;return 0<n.indexOf("@")&&-1===n.indexOf("//")&&-1===n.indexOf("mailto:")?_.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:function(t){return k(k({},t),{href:"mailto:"+n})}}):_.none()},ut=function(t,n){return D([it,(e=d(t),r=t.getParam("link_default_protocol","http","string"),function(t){var n=t.href;return 1===e&&!q(n)||0===e&&/^\s*www[\.|\d\.]/i.test(n)?_.some({message:"The URL you entered seems to be an external link. Do you want to add the required "+r+":// prefix?",preprocess:function(t){return k(k({},t),{href:r+"://"+n})}}):_.none()})],function(t){return t(n)}).fold(function(){return ot.resolve(n)},function(e){return new ot(function(r){var o,i,u,a;o=t,i=e.message,u=function(t){r(t?e.preprocess(n):n)},a=o.selection.getRng(),rt.setEditorTimeout(o,function(){o.windowManager.confirm(i,function(t){o.selection.setRng(a),u(t)})})})});var e,r},at=function(t){var n=function(t,n){return T(function(t,n){for(var e=t.length,r=new Array(e),o=0;o<e;o++){var i=t[o];r[o]=n(i,o)}return r}(t,n))}(t.dom.select("a:not([href])"),function(t){var n=t.name||t.id;return n?[{text:n,value:"#"+n}]:[]});return 0<n.length?_.some([{text:"None",value:""}].concat(n)):_.none()},lt=function(t){var n=t.getParam("link_class_list",[],"array");return 0<n.length?Y(n):_.none()},ct=tinymce.util.Tools.resolve("tinymce.util.XHR"),ft=function(t,n){var e=p(t);if(0<e.length){var r=n.is("_blank");return(!1===y(t)?Z(function(t){return I(nt(t),r)}):Y)(e)}return _.none()},st=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],mt=function(t){var n=v(t);return f(n)?Y(n).orThunk(function(){return _.some(st)}):!1===n?_.none():_.some(st)},gt=function(t,n,e){var r=t.getAttrib(n,e);return null!==r&&0<r.length?_.some(r):_.none()},dt=function(t,n){return(e=t,r=function(t){return e.convertURL(t.value||t.url,"href")},o=e.getParam("link_list"),new ot(function(t){c(o)?ct.send({url:o,success:function(n){return t(function(t){try{return _.some(JSON.parse(t))}catch(t){return _.none()}}(n))},error:function(n){return t(_.none())}}):g(o)?o(function(n){return t(_.some(n))}):t(_.from(o))}).then(function(t){return t.bind(Z(r)).map(function(t){return 0<t.length?[{text:"None",value:""}].concat(t):t})})).then(function(e){var r,o,i,u,a,l,c,f,s=(o=n,i=(r=t).dom,u=V(r.selection.getContent())?_.some(j(r.selection,o)):_.none(),a=o?_.some(i.getAttrib(o,"href")):_.none(),l=o?_.from(i.getAttrib(o,"target")):_.none(),c=gt(i,o,"rel"),f=gt(i,o,"class"),{url:a,text:u,title:gt(i,o,"title"),target:l,rel:c,linkClass:f});return{anchor:s,catalogs:{targets:mt(t),rels:ft(t,s.target),classes:lt(t),anchor:at(t),link:e},optNode:_.from(n),flags:{titleEnabled:t.getParam("link_title",!0,"boolean")}}});var e,r,o},ht=function(t,n){return t.dom.getParent(n,"a[href]")},vt=function(t){return ht(t,t.selection.getStart())},pt=function(n,e){if(e){var r=K(e);if(/^#/.test(r)){var o=n.$(r);o.length&&n.selection.scrollIntoView(o[0],!0)}else!function(n){var e=t.document.createElement("a");e.target="_blank",e.href=n,e.rel="noreferrer noopener";var r,o,i=t.document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,t.window,0,0,0,0,0,!1,!1,!1,!1,0,null),r=e,o=i,t.document.body.appendChild(r),r.dispatchEvent(o),t.document.body.removeChild(r)}(e.href)}},yt=function(t){return function(){!function(t){var n,e;(e=U(n=t),dt(n,e)).then(function(n){var e,r,o,i,u,a,l,c,f,s,m,g;return i=function(t){var n=t.getData();if(!n.url.value)return G(e),void t.close();var o=function(t){return _.from(n[t]).filter(function(n){return!r.anchor[t].is(n)})},i={href:n.url.value,text:o("text"),target:o("target"),rel:o("rel"),class:o("linkClass"),title:o("title")},u={href:n.url.value,attach:void 0!==n.url.meta&&n.url.meta.attach?n.url.meta.attach:function(){}};ut(e,i).then(function(t){z(e,u,t)}),t.close()},u=e=t,c=(o=r=n).anchor.text.map(function(){return{name:"text",type:"input",label:"Text to display"}}).toArray(),f=o.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],l=_.from(h(u)),s={url:{value:(a=o).anchor.url.getOr(""),meta:{attach:function(){},text:a.anchor.url.fold(function(){return""},function(){return a.anchor.text.getOr("")}),original:{value:a.anchor.url.getOr("")}}},text:a.anchor.text.getOr(""),title:a.anchor.title.getOr(""),anchor:a.anchor.url.getOr(""),link:a.anchor.url.getOr(""),rel:a.anchor.rel.getOr(""),target:a.anchor.target.or(l).getOr(""),linkClass:a.anchor.linkClass.getOr("")},m=et(s,o),g=o.catalogs,{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:T([[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],c,f,function(t){for(var n=[],e=function(t){n.push(t)},r=0;r<t.length;r++)t[r].each(e);return n}([g.anchor.map(tt("anchor","Anchors")),g.rels.map(tt("rel","Rel")),g.targets.map(tt("target","Open link in...")),g.link.map(tt("link","Link list")),g.classes.map(tt("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:s,onChange:function(t,n){var e=n.name;m.onChange(t.getData,{name:e}).each(function(n){t.setData(n)})},onSubmit:i}}).then(function(n){t.windowManager.open(n)})}(t)}},kt=function(t){return function(){pt(t,vt(t))}},xt=function(t){t.on("click",function(n){var e=ht(t,n.target);e&&u.metaKeyPressed(n)&&(n.preventDefault(),pt(t,e))}),t.on("keydown",function(n){var e,r=vt(t);r&&13===n.keyCode&&!0===(e=n).altKey&&!1===e.shiftKey&&!1===e.ctrlKey&&!1===e.metaKey&&(n.preventDefault(),pt(t,r))})},bt=function(t){return function(n){var e=function(e){return n.setActive(!t.mode.isReadOnly()&&!!U(t,e.element))};return t.on("NodeChange",e),function(){return t.off("NodeChange",e)}}},Ot=function(t){return function(n){var e=t.dom.getParents(t.selection.getStart());n.setDisabled(!F(e));var r=function(t){return n.setDisabled(!F(t.parents))};return t.on("NodeChange",r),function(){return t.off("NodeChange",r)}}};i.add("link",function(t){var n,e,r,o,i,u,a;(n=t).ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:yt(n),onSetup:bt(n)}),n.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:kt(n),onSetup:Ot(n)}),n.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:function(){return G(n)},onSetup:Ot(n)}),(e=t).ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:kt(e),onSetup:Ot(e)}),e.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:yt(e)}),e.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:function(){return G(e)},onSetup:Ot(e)}),(r=t).ui.registry.addContextMenu("link",{update:function(t){return F(r.dom.getParents(t,"a"))?"link unlink openlink":"link"}}),i=function(t){var n=o.selection.getNode();return t.setDisabled(!U(o,n)),function(){}},(o=t).ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:bt(o)},label:"Link",predicate:function(t){return!!U(o,t)&&o.getParam("link_context_toolbar",!1,"boolean")},initValue:function(){var t=U(o);return t?K(t):""},commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:function(t){var n=o.selection.getNode();return t.setActive(!!U(o,n)),bt(o)(t)},onAction:function(t){var n=U(o),e=t.getValue();if(n)o.dom.setAttrib(n,"href",e),o.selection.collapse(!1),t.hide();else{var r={href:e,attach:function(){}},i=V(o.selection.getContent())?_.some(j(o.selection,n)).filter(function(t){return 0<t.length}).or(_.from(e)):_.none();z(o,r,{href:e,text:i,title:_.none(),rel:_.none(),target:_.none(),class:_.none()}),t.hide()}}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:i,onAction:function(t){G(o),t.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:i,onAction:function(t){kt(o)(),t.hide()}}]}),xt(t),(u=t).addCommand("mceLink",function(){u.getParam("link_quicklink",!1,"boolean")?u.fire("contexttoolbar-show",{toolbarKey:"quicklink"}):yt(u)()}),(a=t).addShortcut("Meta+K","",function(){a.execCommand("mceLink")})})}(window);