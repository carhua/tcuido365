!function(){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager"),e=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),r=tinymce.util.Tools.resolve("tinymce.EditorManager"),n=tinymce.util.Tools.resolve("tinymce.Env"),i=tinymce.util.Tools.resolve("tinymce.util.Tools"),o=function(t){return t.getParam("importcss_selector_converter")},s=("array",function(t){return r=typeof(e=t),"array"===(null===e?"null":"object"==r&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"==r&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":r);var e,r}),c=Array.prototype.push,a=function(t,e){return function(t){for(var e=[],r=0,n=t.length;r<n;++r){if(!s(t[r]))throw new Error("Arr.flatten item "+r+" was not an array, input: "+t);c.apply(e,t[r])}return e}(function(t,e){for(var r=t.length,n=new Array(r),i=0;i<r;i++){var o=t[i];n[i]=e(o,i)}return n}(t,e))},u=function(t){return"string"==typeof t?function(e){return-1!==e.indexOf(t)}:t instanceof RegExp?function(e){return t.test(e)}:t},l=function(t,e,o){var s=[],c={};i.each(t.contentCSS,function(t){c[t]=!0}),o=o||function(t,e){return e||c[t]};try{i.each(e.styleSheets,function(e){!function e(c,a){var u,l,f,m=c.href;if(l=m,f=n.cacheSuffix,"string"==typeof l&&(l=l.replace("?"+f,"").replace("&"+f,"")),(m=l)&&o(m,a)&&!function(t,e){var n=t.settings,i=!1!==n.skin&&(n.skin||"oxide");if(i){var o=n.skin_url?t.documentBaseURI.toAbsolute(n.skin_url):r.baseURL+"/skins/ui/"+i,s=r.baseURL+"/skins/content/";return e===o+"/content"+(t.inline?".inline":"")+".min.css"||-1!==e.indexOf(s)}return!1}(t,m)){i.each(c.imports,function(t){e(t,!0)});try{u=c.cssRules||c.rules}catch(t){}i.each(u,function(t){t.styleSheet?e(t.styleSheet,!0):t.selectorText&&i.each(t.selectorText.split(","),function(t){s.push(i.trim(t))})})}}(e)})}catch(t){}return s},f=function(t,e){var r,n=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(e);if(n){var o=n[1],s=n[2].substr(1).split(".").join(" "),c=i.makeMap("a,img");return n[1]?(r={title:e},t.schema.getTextBlockElements()[o]?r.block=o:t.schema.getBlockElements()[o]||c[o.toLowerCase()]?r.selector=o:r.inline=o):n[2]&&(r={inline:"span",title:e.substr(1),classes:s}),!1!==t.getParam("importcss_merge_classes")?r.classes=s:r.attributes={class:s},r}},m=function(t,e){return null===e||!1!==t.getParam("importcss_exclusive")};t.add("importcss",function(t){return(r=t).on("init",function(t){var n,s,c,p,v=(n=[],s=[],c={},{addItemToGroup:function(t,e){c[t]?c[t].push(e):(s.push(t),c[t]=[e])},addItem:function(t){n.push(t)},toFormats:function(){return a(s,function(t){var e=c[t];return 0===e.length?[]:[{title:t,items:e}]}).concat(n)}}),y={},g=u(r.getParam("importcss_selector_filter")),h=(p=r.getParam("importcss_groups"),i.map(p,function(t){return i.extend({},t,{original:t,selectors:{},filter:u(t.filter),item:{text:t.title,menu:[]}})})),d=function(t,n){if(d=t,x=y,!(m(r,_=n)?d in x:d in _.selectors)){v=t,h=y,m(r,g=n)?h[v]=!0:g.selectors[v]=!0;var s=(u=(a=r).plugins.importcss,l=t,((p=n)&&p.selector_converter?p.selector_converter:o(a)?o(a):function(){return f(a,l)}).call(u,l,p));if(s){var c=s.name||e.DOM.uniqueId();return r.formatter.register(c,s),i.extend({},{title:s.title,format:c})}}var a,u,l,p,v,g,h,d,_,x;return null};i.each(l(r,r.getDoc(),u(r.getParam("importcss_file_filter"))),function(t){if(-1===t.indexOf(".mce-")&&(!g||g(t))){var e=(n=h,o=t,i.grep(n,function(t){return!t.filter||t.filter(o)}));if(0<e.length)i.each(e,function(e){var r=d(t,e);r&&v.addItemToGroup(e.title,r)});else{var r=d(t,null);r&&v.addItem(r)}}var n,o});var _=v.toFormats();r.fire("addStyleModifications",{items:_,replace:!r.getParam("importcss_append")})}),n=t,{convertSelectorToFormat:function(t){return f(n,t)}};var r,n})}();